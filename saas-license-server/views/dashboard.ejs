<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <% if (typeof csrfToken !=='undefined' && csrfToken) { %>
        <meta name="csrf-token" content="<%= csrfToken %>">
        <% } %>
            <title>Painel Administrativo - Plugin Cripto Woocommerce</title>
            <!-- Bootstrap 5 -->
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
            <!-- FontAwesome -->
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
            <!-- Google Fonts -->
            <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap"
                rel="stylesheet">

            <%- include('partials/admin-layout-styles') %>

                <!-- ESTILOS PARA MODAIS PERSONALIZADOS -->
                <style>
                    /* Modal Personalizado */
                    .custom-modal-overlay {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.7);
                        backdrop-filter: blur(4px);
                        z-index: 10000;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        animation: fadeIn 0.2s ease;
                    }

                    .custom-modal {
                        background: var(--bg-card, #1e293b);
                        border: 1px solid var(--border-light, rgba(255, 255, 255, 0.1));
                        border-radius: 16px;
                        padding: 0;
                        max-width: 500px;
                        width: 90%;
                        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
                        animation: slideUp 0.3s ease;
                        overflow: hidden;
                    }

                    .custom-modal-header {
                        padding: 1.5rem 2rem;
                        border-bottom: 1px solid var(--border-light, rgba(255, 255, 255, 0.1));
                        display: flex;
                        align-items: center;
                        gap: 1rem;
                    }

                    .custom-modal-header.warning {
                        background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.05) 100%);
                        border-bottom-color: rgba(239, 68, 68, 0.3);
                    }

                    .custom-modal-header.success {
                        background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(22, 163, 74, 0.05) 100%);
                        border-bottom-color: rgba(34, 197, 94, 0.3);
                    }

                    .custom-modal-header.error {
                        background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(220, 38, 38, 0.1) 100%);
                        border-bottom-color: rgba(239, 68, 68, 0.4);
                    }

                    .custom-modal-icon {
                        width: 48px;
                        height: 48px;
                        border-radius: 12px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 24px;
                        flex-shrink: 0;
                    }

                    .custom-modal-icon.warning {
                        background: rgba(239, 68, 68, 0.2);
                        color: #f87171;
                    }

                    .custom-modal-icon.success {
                        background: rgba(34, 197, 94, 0.2);
                        color: #4ade80;
                    }

                    .custom-modal-icon.error {
                        background: rgba(239, 68, 68, 0.3);
                        color: #f87171;
                    }

                    .custom-modal-title {
                        color: var(--text-primary, #f1f5f9);
                        font-size: 1.25rem;
                        font-weight: 600;
                        margin: 0;
                        flex: 1;
                    }

                    .custom-modal-body {
                        padding: 2rem;
                        color: var(--text-secondary, #cbd5e1);
                        line-height: 1.6;
                    }

                    .custom-modal-body strong {
                        color: var(--text-primary, #f1f5f9);
                        font-weight: 600;
                    }

                    .custom-modal-body ul {
                        margin: 1rem 0;
                        padding-left: 1.5rem;
                    }

                    .custom-modal-body li {
                        margin: 0.5rem 0;
                        color: var(--text-secondary, #cbd5e1);
                    }

                    .custom-modal-footer {
                        padding: 1.5rem 2rem;
                        border-top: 1px solid var(--border-light, rgba(255, 255, 255, 0.1));
                        display: flex;
                        gap: 1rem;
                        justify-content: flex-end;
                    }

                    .custom-modal-btn {
                        padding: 0.75rem 1.5rem;
                        border-radius: 8px;
                        font-weight: 500;
                        cursor: pointer;
                        border: none;
                        transition: all 0.2s ease;
                        font-size: 0.95rem;
                    }

                    .custom-modal-btn-primary {
                        background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
                        color: white;
                    }

                    .custom-modal-btn-primary:hover {
                        background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
                        transform: translateY(-1px);
                        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
                    }

                    .custom-modal-btn-danger {
                        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                        color: white;
                    }

                    .custom-modal-btn-danger:hover {
                        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
                        transform: translateY(-1px);
                        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
                    }

                    .custom-modal-btn-secondary {
                        background: var(--bg-tertiary, #334155);
                        color: var(--text-primary, #f1f5f9);
                        border: 1px solid var(--border-light, rgba(255, 255, 255, 0.1));
                    }

                    .custom-modal-btn-secondary:hover {
                        background: var(--bg-secondary, #475569);
                        border-color: var(--border, rgba(255, 255, 255, 0.2));
                    }

                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }

                    @keyframes slideUp {
                        from {
                            opacity: 0;
                            transform: translateY(20px) scale(0.95);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0) scale(1);
                        }
                    }

                    @keyframes fadeOut {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }

                    @keyframes slideDown {
                        from {
                            opacity: 1;
                            transform: translateY(0) scale(1);
                        }
                        to {
                            opacity: 0;
                            transform: translateY(20px) scale(0.95);
                        }
                    }
                </style>

                <!-- SCRIPT CR√çTICO: Definir deleteClient ANTES de qualquer HTML -->
                <script>
                    // Fun√ß√µes para modais personalizados
                    window.showCustomConfirm = function(options) {
                        return new Promise(function(resolve) {
                            const overlay = document.createElement('div');
                            overlay.className = 'custom-modal-overlay';
                            
                            const modal = document.createElement('div');
                            modal.className = 'custom-modal';
                            
                            const headerClass = options.type === 'warning' ? 'warning' : options.type === 'error' ? 'error' : '';
                            const iconClass = options.type === 'warning' ? 'warning' : options.type === 'error' ? 'error' : 'success';
                            const icon = options.type === 'warning' || options.type === 'error' ? '‚ö†Ô∏è' : '‚úÖ';
                            
                            modal.innerHTML = `
                                <div class="custom-modal-header ${headerClass}">
                                    <div class="custom-modal-icon ${iconClass}">${icon}</div>
                                    <h3 class="custom-modal-title">${options.title || 'Confirma√ß√£o'}</h3>
                                </div>
                                <div class="custom-modal-body">
                                    ${options.message || ''}
                                </div>
                                <div class="custom-modal-footer">
                                    <button class="custom-modal-btn custom-modal-btn-secondary" data-action="cancel">Cancelar</button>
                                    <button class="custom-modal-btn ${options.danger ? 'custom-modal-btn-danger' : 'custom-modal-btn-primary'}" data-action="confirm">${options.confirmText || 'Confirmar'}</button>
                                </div>
                            `;
                            
                            overlay.appendChild(modal);
                            document.body.appendChild(overlay);
                            
                            function close(result) {
                                overlay.style.animation = 'fadeOut 0.2s ease';
                                modal.style.animation = 'slideDown 0.2s ease';
                                setTimeout(function() {
                                    document.body.removeChild(overlay);
                                }, 200);
                                resolve(result);
                            }
                            
                            modal.querySelectorAll('[data-action]').forEach(function(btn) {
                                btn.addEventListener('click', function() {
                                    close(btn.dataset.action === 'confirm');
                                });
                            });
                            
                            overlay.addEventListener('click', function(e) {
                                if (e.target === overlay) {
                                    close(false);
                                }
                            });
                        });
                    };

                    window.showCustomAlert = function(options) {
                        return new Promise(function(resolve) {
                            const overlay = document.createElement('div');
                            overlay.className = 'custom-modal-overlay';
                            
                            const modal = document.createElement('div');
                            modal.className = 'custom-modal';
                            
                            const headerClass = options.type === 'error' ? 'error' : options.type === 'success' ? 'success' : '';
                            const iconClass = options.type === 'error' ? 'error' : options.type === 'success' ? 'success' : 'warning';
                            const icon = options.type === 'error' ? '‚ùå' : options.type === 'success' ? '‚úÖ' : '‚ö†Ô∏è';
                            
                            modal.innerHTML = `
                                <div class="custom-modal-header ${headerClass}">
                                    <div class="custom-modal-icon ${iconClass}">${icon}</div>
                                    <h3 class="custom-modal-title">${options.title || 'Aviso'}</h3>
                                </div>
                                <div class="custom-modal-body">
                                    ${options.message || ''}
                                </div>
                                <div class="custom-modal-footer">
                                    <button class="custom-modal-btn custom-modal-btn-primary" data-action="ok">OK</button>
                                </div>
                            `;
                            
                            overlay.appendChild(modal);
                            document.body.appendChild(overlay);
                            
                            function close() {
                                overlay.style.animation = 'fadeOut 0.2s ease';
                                modal.style.animation = 'slideDown 0.2s ease';
                                setTimeout(function() {
                                    document.body.removeChild(overlay);
                                }, 200);
                                resolve();
                            }
                            
                            modal.querySelector('[data-action="ok"]').addEventListener('click', close);
                            
                            overlay.addEventListener('click', function(e) {
                                if (e.target === overlay) {
                                    close();
                                }
                            });
                        });
                    };

                    // Definir fun√ß√£o deleteClient IMEDIATAMENTE no head para garantir disponibilidade
                    window.deleteClient = function deleteClient(email) {
                        // Primeira confirma√ß√£o com modal personalizado
                        window.showCustomConfirm({
                            type: 'warning',
                            title: '‚ö†Ô∏è ATEN√á√ÉO',
                            message: `
                                <p>Voc√™ est√° prestes a <strong>EXCLUIR PERMANENTEMENTE</strong> o cliente:</p>
                                <p style="text-align: center; margin: 1rem 0; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px; font-weight: 600; color: #f87171;">
                                    ${email}
                                </p>
                                <p><strong>Esta a√ß√£o ir√°:</strong></p>
                                <ul>
                                    <li>Remover a licen√ßa</li>
                                    <li>Deletar o usu√°rio</li>
                                    <li>Apagar todos os logs</li>
                                    <li>Remover todas as notifica√ß√µes</li>
                                </ul>
                                <p style="color: #f87171; font-weight: 600; margin-top: 1rem;">
                                    ‚ö†Ô∏è Esta a√ß√£o N√ÉO PODE SER DESFEITA!
                                </p>
                            `,
                            confirmText: 'Continuar',
                            danger: true
                        }).then(function(confirmed) {
                            if (!confirmed) return;

                            // Segunda confirma√ß√£o
                            window.showCustomConfirm({
                                type: 'warning',
                                title: 'Confirma√ß√£o Final',
                                message: `
                                    <p>Confirme novamente:</p>
                                    <p style="text-align: center; margin: 1rem 0; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px; font-weight: 600; color: #f87171;">
                                        Excluir <strong>${email}</strong> PERMANENTEMENTE?
                                    </p>
                                `,
                                confirmText: 'Sim, Excluir',
                                danger: true
                            }).then(function(confirmedSecond) {
                                if (!confirmedSecond) return;

                        // Obter token CSRF
                        var csrfMeta = document.querySelector('meta[name="csrf-token"]');
                        var csrfToken = csrfMeta ? csrfMeta.getAttribute('content') : '';

                        console.log('üóëÔ∏è Deletando cliente:', email);
                        console.log('üîë CSRF Token:', csrfToken ? 'Presente' : 'Ausente');

                        fetch('/admin/delete-client', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'CSRF-Token': csrfToken,
                                'X-CSRF-Token': csrfToken
                            },
                            body: JSON.stringify({
                                email: email,
                                _csrf: csrfToken
                            }),
                            credentials: 'same-origin'
                        })
                            .then(function (response) {
                                console.log('üì° Resposta do servidor:', response.status, response.statusText);
                                if (!response.ok) {
                                    return response.json().then(function(err) {
                                        throw new Error(err.message || 'Erro ao deletar cliente');
                                    });
                                }
                                return response.json();
                            })
                            .then(function (result) {
                                console.log('‚úÖ Resultado:', result);
                                if (result.success) {
                                    window.showCustomAlert({
                                        type: 'success',
                                        title: '‚úÖ Sucesso',
                                        message: '<p>Cliente exclu√≠do com sucesso!</p>'
                                    }).then(function() {
                                        window.location.reload();
                                    });
                                } else {
                                    window.showCustomAlert({
                                        type: 'error',
                                        title: '‚ùå Erro',
                                        message: '<p>' + (result.message || 'Falha ao excluir cliente') + '</p>'
                                    });
                                }
                            })
                            .catch(function (error) {
                                console.error('‚ùå Erro ao deletar cliente:', error);
                                window.showCustomAlert({
                                    type: 'error',
                                    title: '‚ùå Erro',
                                    message: '<p>Erro ao excluir cliente: <strong>' + error.message + '</strong></p><p style="margin-top: 0.5rem; font-size: 0.9rem; opacity: 0.8;">Verifique o console para mais detalhes.</p>'
                                });
                            });
                                });
                            });
                    };
                    
                    console.log('‚úÖ [HEAD] Fun√ß√£o deleteClient definida no escopo global');
                    console.log('‚úÖ [HEAD] window.deleteClient:', typeof window.deleteClient);

                    // Fun√ß√£o para expandir/colapsar detalhes da linha (DEFINIR NO HEAD)
                    window.toggleRowDetails = function toggleRowDetails(index) {
                        console.log('üîç toggleRowDetails chamado com index:', index);
                        const detailsRow = document.getElementById('details-' + index);
                        const mainRow = document.querySelector('[data-license-id="license-' + index + '"]');
                        
                        if (!detailsRow) {
                            console.error('‚ùå Erro: detailsRow n√£o encontrado para index:', index);
                            return;
                        }
                        
                        if (!mainRow) {
                            console.error('‚ùå Erro: mainRow n√£o encontrado para index:', index);
                            return;
                        }
                        
                        const expandBtn = mainRow.querySelector('.btn-expand-row');

                        if (detailsRow.style.display === 'none' || !detailsRow.style.display) {
                            detailsRow.style.display = 'table-row';
                            mainRow.classList.add('expanded');
                            if (expandBtn) {
                                expandBtn.classList.add('expanded');
                            }
                            console.log('‚úÖ Linha expandida para index:', index);
                        } else {
                            detailsRow.style.display = 'none';
                            mainRow.classList.remove('expanded');
                            if (expandBtn) {
                                expandBtn.classList.remove('expanded');
                            }
                            console.log('‚úÖ Linha colapsada para index:', index);
                        }
                    };
                    
                    console.log('‚úÖ [HEAD] Fun√ß√£o toggleRowDetails definida no escopo global');
                    console.log('‚úÖ [HEAD] window.toggleRowDetails:', typeof window.toggleRowDetails);

                    // Fun√ß√£o para abrir modal de novo cliente (definir no HEAD para garantir disponibilidade)
                    // Esta ser√° sobrescrita quando Bootstrap carregar, mas serve como fallback
                    window.openNewClientModal = function() {
                        console.log('üîç [HEAD] Tentando abrir modal de novo cliente...');
                        const modal = document.getElementById('newClientModal');
                        if (modal) {
                            // Tentar usar Bootstrap se dispon√≠vel
                            if (typeof bootstrap !== 'undefined' && typeof bootstrap.Modal !== 'undefined') {
                                const bsModal = new bootstrap.Modal(modal);
                                bsModal.show();
                            } else {
                                // Fallback manual
                                modal.style.display = 'block';
                                modal.classList.add('show');
                                document.body.classList.add('modal-open');
                            }
                        } else {
                            console.error('‚ùå Modal newClientModal n√£o encontrado');
                        }
                    };
                    
                    console.log('‚úÖ [HEAD] Fun√ß√£o openNewClientModal definida no escopo global');
                    console.log('‚úÖ [HEAD] window.openNewClientModal:', typeof window.openNewClientModal);
                </script>

                <!-- OVERRIDE CR√çTICO DO BOOTSTRAP - REMOVER CORES ESCURAS DOS PLACEHOLDERS -->
                <style type="text/css">
                    /* DESABILITAR COMPLETAMENTE OS ESTILOS DE PLACEHOLDER DO BOOTSTRAP */
                    /* O Bootstrap 5 por padr√£o usa cores escuras/cinzas nos placeholders */
                    /* Este estilo deve ser aplicado IMEDIATAMENTE ap√≥s o Bootstrap ser carregado */

                    /* Sobrescrever vari√°veis CSS do Bootstrap se existirem */
                    :root {
                        --bs-secondary-color: #ffffff !important;
                        --bs-placeholder-color: #ffffff !important;
                    }

                    /* For√ßar placeholders brancos em TODOS os inputs */
                    .form-control::placeholder,
                    .form-control::-webkit-input-placeholder,
                    .form-control::-moz-placeholder,
                    .form-control:-ms-input-placeholder,
                    input.form-control::placeholder,
                    input.form-control::-webkit-input-placeholder,
                    input.form-control::-moz-placeholder,
                    input.form-control:-ms-input-placeholder,
                    input[type="text"].form-control::placeholder,
                    input[type="text"].form-control::-webkit-input-placeholder,
                    input[type="text"].form-control::-moz-placeholder,
                    input[type="text"].form-control:-ms-input-placeholder,
                    input[type="password"].form-control::placeholder,
                    input[type="password"].form-control::-webkit-input-placeholder,
                    input[type="password"].form-control::-moz-placeholder,
                    input[type="password"].form-control:-ms-input-placeholder,
                    input[type="email"].form-control::placeholder,
                    input[type="email"].form-control::-webkit-input-placeholder,
                    input[type="email"].form-control::-moz-placeholder,
                    input[type="email"].form-control:-ms-input-placeholder,
                    input[type="number"].form-control::placeholder,
                    input[type="number"].form-control::-webkit-input-placeholder,
                    input[type="number"].form-control::-moz-placeholder,
                    input[type="number"].form-control:-ms-input-placeholder,
                    textarea.form-control::placeholder,
                    textarea.form-control::-webkit-input-placeholder,
                    textarea.form-control::-moz-placeholder,
                    textarea.form-control:-ms-input-placeholder {
                        color: #ffffff !important;
                        opacity: 1 !important;
                        font-weight: 500 !important;
                    }
                </style>

                <!-- ESTILO IMEDIATO PARA SOBRESCREVER BOOTSTRAP - PLACEHOLDERS E BACKGROUND -->
                <style id="bootstrap-placeholder-override">
                    /* FOR√áAR BACKGROUND ESCURO SEMPRE - SOBRESCREVER BOOTSTRAP COMPLETAMENTE */
                    .form-control,
                    .form-control:not(:placeholder-shown),
                    .form-control:valid,
                    .form-control:invalid,
                    .form-control[value],
                    .form-control[value]:not([value=""]),
                    input.form-control,
                    input.form-control:not(:placeholder-shown),
                    input.form-control:valid,
                    input.form-control:invalid,
                    input.form-control[value],
                    input.form-control[value]:not([value=""]),
                    textarea.form-control,
                    textarea.form-control:not(:placeholder-shown) {
                        background: #1e293b !important;
                        background-color: #1e293b !important;
                        color: #f1f5f9 !important;
                    }

                    /* FOR√áAR PLACEHOLDERS BRANCOS - SOBRESCREVER BOOTSTRAP COMPLETAMENTE */
                    .form-control::placeholder,
                    .form-control::-webkit-input-placeholder,
                    .form-control::-moz-placeholder,
                    .form-control:-ms-input-placeholder,
                    input.form-control::placeholder,
                    input.form-control::-webkit-input-placeholder,
                    input.form-control::-moz-placeholder,
                    input.form-control:-ms-input-placeholder,
                    input[type="text"].form-control::placeholder,
                    input[type="text"].form-control::-webkit-input-placeholder,
                    input[type="text"].form-control::-moz-placeholder,
                    input[type="text"].form-control:-ms-input-placeholder,
                    input[type="password"].form-control::placeholder,
                    input[type="password"].form-control::-webkit-input-placeholder,
                    input[type="password"].form-control::-moz-placeholder,
                    input[type="password"].form-control:-ms-input-placeholder,
                    input[type="email"].form-control::placeholder,
                    input[type="email"].form-control::-webkit-input-placeholder,
                    input[type="email"].form-control::-moz-placeholder,
                    input[type="email"].form-control:-ms-input-placeholder,
                    input[type="number"].form-control::placeholder,
                    input[type="number"].form-control::-webkit-input-placeholder,
                    input[type="number"].form-control::-moz-placeholder,
                    input[type="number"].form-control:-ms-input-placeholder,
                    textarea.form-control::placeholder,
                    textarea.form-control::-webkit-input-placeholder,
                    textarea.form-control::-moz-placeholder,
                    textarea.form-control:-ms-input-placeholder {
                        color: #ffffff !important;
                        opacity: 1 !important;
                        font-weight: 600 !important;
                        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.8) !important;
                    }
                </style>

                <style>
                    /* Estilos espec√≠ficos do Dashboard - usando vari√°veis do admin-layout-styles */

                    /* Layout com Sidebar */
                    .admin-layout {
                        display: flex;
                        min-height: 100vh;
                    }

                    /* Sidebar */
                    .sidebar {
                        width: 280px;
                        background: linear-gradient(180deg, rgba(19, 23, 34, 0.95) 0%, rgba(13, 17, 26, 0.95) 100%);
                        border-right: 1px solid rgba(30, 37, 50, 0.6);
                        position: fixed;
                        height: 100vh;
                        left: 0;
                        top: 0;
                        z-index: 1000;
                        overflow-y: auto;
                        backdrop-filter: blur(10px);
                        transition: transform 0.3s ease;
                    }

                    .sidebar::-webkit-scrollbar {
                        width: 6px;
                    }

                    .sidebar::-webkit-scrollbar-track {
                        background: rgba(19, 23, 34, 0.5);
                    }

                    .sidebar::-webkit-scrollbar-thumb {
                        background: rgba(99, 102, 241, 0.3);
                        border-radius: 3px;
                    }

                    .sidebar-header {
                        padding: 2rem 1.5rem;
                        border-bottom: 1px solid rgba(30, 37, 50, 0.6);
                    }

                    .sidebar-brand {
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        color: var(--text-primary);
                        font-weight: 700;
                        font-size: 1.2rem;
                        text-decoration: none;
                    }

                    .sidebar-brand i {
                        color: var(--primary);
                        font-size: 1.5rem;
                    }

                    .sidebar-menu {
                        padding: 1.5rem 0;
                    }

                    .menu-item {
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        padding: 0.875rem 1.5rem;
                        color: var(--text-secondary);
                        text-decoration: none;
                        transition: all 0.2s ease;
                        border-left: 3px solid transparent;
                        font-weight: 500;
                        font-size: 0.9rem;
                    }

                    .menu-item:hover {
                        background: rgba(99, 102, 241, 0.1);
                        color: var(--primary);
                        border-left-color: var(--primary);
                    }

                    .menu-item.active {
                        background: rgba(99, 102, 241, 0.15);
                        color: var(--primary);
                        border-left-color: var(--primary);
                    }

                    .menu-item i {
                        width: 20px;
                        text-align: center;
                        font-size: 1.1rem;
                    }

                    .menu-section {
                        padding: 1rem 1.5rem 0.5rem;
                        font-size: 0.75rem;
                        text-transform: uppercase;
                        letter-spacing: 1px;
                        color: var(--text-secondary);
                        font-weight: 600;
                    }

                    /* Conte√∫do Principal */
                    .main-content {
                        flex: 1;
                        margin-left: 280px;
                        transition: margin-left 0.3s ease;
                    }

                    /* Navbar Superior */
                    .top-navbar {
                        background: rgba(19, 23, 34, 0.8);
                        backdrop-filter: blur(10px);
                        border-bottom: 1px solid rgba(30, 37, 50, 0.5);
                        padding: 1.25rem 2rem;
                        position: sticky;
                        top: 0;
                        z-index: 999;
                    }

                    /* Responsivo */
                    @media (max-width: 768px) {
                        .sidebar {
                            transform: translateX(-100%);
                        }

                        .sidebar.open {
                            transform: translateX(0);
                        }

                        .main-content {
                            margin-left: 0;
                        }

                        .menu-toggle {
                            display: block !important;
                        }
                    }

                    .menu-toggle {
                        display: none;
                        background: rgba(30, 37, 50, 0.5);
                        border: 1px solid rgba(30, 37, 50, 0.8);
                        color: var(--text-primary);
                        padding: 0.5rem 1rem;
                        border-radius: 8px;
                        cursor: pointer;
                    }

                    /* Navbar */
                    .navbar {
                        background: rgba(19, 23, 34, 0.8);
                        backdrop-filter: blur(10px);
                        border-bottom: 1px solid rgba(30, 37, 50, 0.5);
                        padding: 1.25rem 0;
                        box-shadow: var(--shadow-sm);
                    }

                    .navbar-brand {
                        font-weight: 700;
                        color: var(--text-primary) !important;
                        font-size: 1.2rem;
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        letter-spacing: -0.5px;
                    }

                    .navbar-brand i {
                        color: var(--primary);
                        font-size: 1.4rem;
                    }

                    .btn-nav {
                        background: rgba(30, 37, 50, 0.5);
                        border: 1px solid rgba(30, 37, 50, 0.8);
                        color: var(--text-primary);
                        padding: 0.6rem 1.2rem;
                        border-radius: 10px;
                        font-size: 0.875rem;
                        font-weight: 500;
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        text-decoration: none;
                        display: inline-flex;
                        align-items: center;
                        gap: 8px;
                        backdrop-filter: blur(10px);
                    }

                    .btn-nav:hover {
                        background: rgba(99, 102, 241, 0.1);
                        border-color: var(--primary);
                        color: var(--primary);
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
                    }

                    .btn-accent {
                        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
                        color: #fff;
                        border: none;
                        font-weight: 600;
                        box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
                    }

                    .btn-accent:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
                        background: linear-gradient(135deg, var(--primary-hover) 0%, var(--primary) 100%);
                    }

                    /* Stats Cards */
                    .stat-card {
                        background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
                        border: 1px solid var(--border-light);
                        border-radius: 12px;
                        padding: 1.5rem;
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        position: relative;
                        overflow: hidden;
                        box-shadow: var(--shadow-sm);
                        cursor: pointer;
                    }

                    .stat-card::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        height: 3px;
                        background: linear-gradient(90deg, var(--primary), var(--accent));
                        opacity: 0;
                        transition: opacity 0.3s;
                    }

                    .stat-card:hover {
                        transform: translateY(-2px);
                        border-color: var(--primary);
                        box-shadow: var(--shadow-md);
                    }

                    .stat-card:hover::before {
                        opacity: 1;
                    }

                    .stat-trend {
                        display: flex;
                        align-items: center;
                        gap: 0.5rem;
                        font-size: 0.75rem;
                        margin-top: 0.5rem;
                        font-weight: 500;
                    }

                    .stat-trend.up {
                        color: var(--success);
                    }

                    .stat-trend.down {
                        color: var(--danger);
                    }

                    .stat-trend.neutral {
                        color: var(--text-muted);
                    }

                    .stat-link {
                        margin-top: 0.75rem;
                        font-size: 0.75rem;
                        color: var(--primary);
                        text-decoration: none;
                        display: inline-flex;
                        align-items: center;
                        gap: 0.25rem;
                        transition: gap 0.2s;
                    }

                    .stat-link:hover {
                        gap: 0.5rem;
                        color: var(--accent);
                    }

                    .stat-label {
                        font-size: 0.8rem;
                        color: var(--text-secondary);
                        margin-bottom: 0.75rem;
                        text-transform: uppercase;
                        letter-spacing: 1px;
                        font-weight: 600;
                    }

                    .stat-value {
                        font-size: 2rem;
                        font-weight: 700;
                        color: var(--text-primary);
                        letter-spacing: -1px;
                        line-height: 1.2;
                        margin: 0.5rem 0;
                    }

                    .stat-value.highlight-success {
                        color: var(--success);
                    }

                    .stat-value.highlight-primary {
                        color: var(--primary);
                    }

                    .stat-value.highlight-info {
                        color: var(--info);
                    }

                    .stat-icon {
                        font-size: 2.75rem;
                        opacity: 0.08;
                        transition: opacity 0.3s;
                    }

                    .stat-card:hover .stat-icon {
                        opacity: 0.15;
                    }

                    /* Main Content */
                    .content-card {
                        background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
                        border: 1px solid var(--border-light);
                        border-radius: 12px;
                        padding: 0;
                        margin-bottom: 2rem;
                        overflow: hidden;
                        box-shadow: var(--shadow-sm);
                        transition: all 0.3s ease;
                    }

                    /* Padding para cards de gr√°ficos */
                    .content-card>.card-title:first-child {
                        padding: 1.75rem 2rem 1.25rem 2rem;
                        margin: 0;
                    }

                    .content-card>canvas {
                        padding: 0 2rem 2rem 2rem;
                        display: block;
                    }

                    /* Para cards que usam card-header-custom, manter padding original */
                    .content-card>.card-header-custom+* {
                        padding: 1.5rem 2rem;
                    }

                    .content-card:hover {
                        box-shadow: var(--shadow-lg);
                        border-color: var(--border);
                    }

                    .card-header-custom {
                        background: var(--bg-tertiary);
                        border-bottom: 1px solid var(--border-light);
                        padding: 1.5rem 2rem;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        backdrop-filter: blur(10px);
                    }

                    .card-title {
                        font-size: 1.15rem;
                        font-weight: 700;
                        color: var(--text-primary);
                        margin: 0;
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        letter-spacing: -0.3px;
                    }

                    .card-title i,
                    .content-card .card-title i {
                        color: var(--text-secondary) !important;
                    }

                    /* Table Container - FOR√áAR FUNDO ESCURO */
                    .table-container,
                    .table-responsive.table-container,
                    div.table-responsive {
                        background: var(--bg-card) !important;
                        background-color: var(--bg-card) !important;
                        border-radius: 12px;
                        overflow: hidden;
                        border: 1px solid var(--border-light);
                    }

                    /* Table - FOR√áAR FUNDO ESCURO */
                    .table,
                    .table.table-expandable,
                    table.table {
                        margin-bottom: 0;
                        color: var(--text-primary);
                        background: var(--bg-card) !important;
                        background-color: var(--bg-card) !important;
                        border-collapse: separate;
                        border-spacing: 0;
                    }

                    /* Remover qualquer fundo branco do Bootstrap */
                    .table tbody,
                    .table tbody tr,
                    .table tbody tr td {
                        background-color: transparent !important;
                    }

                    .table thead th {
                        background: var(--bg-tertiary);
                        border-bottom: 2px solid var(--border-light);
                        color: var(--text-secondary);
                        font-weight: 700;
                        font-size: 0.75rem;
                        text-transform: uppercase;
                        letter-spacing: 1px;
                        padding: 1.25rem 1.5rem;
                    }

                    .table tbody {
                        background: var(--bg-card) !important;
                        background-color: var(--bg-card) !important;
                    }

                    .table tbody tr {
                        transition: all 0.2s ease;
                        background: var(--bg-secondary) !important;
                        background-color: var(--bg-secondary) !important;
                        border-bottom: 1px solid var(--border-light);
                    }

                    .table tbody tr:nth-child(even) {
                        background: rgba(30, 41, 59, 0.5) !important;
                        background-color: rgba(30, 41, 59, 0.5) !important;
                    }

                    .table tbody tr td {
                        background: transparent !important;
                        background-color: transparent !important;
                    }

                    /* Garantir que o fundo da linha seja vis√≠vel atrav√©s das c√©lulas */
                    .table tbody tr td {
                        background-color: transparent !important;
                    }

                    /* Linhas alternadas - aplicar fundo na linha, n√£o nas c√©lulas */
                    .table tbody tr:nth-child(odd) {
                        background-color: var(--bg-secondary) !important;
                    }

                    .table tbody tr:nth-child(even) {
                        background-color: rgba(30, 41, 59, 0.5) !important;
                    }

                    /* Garantir que o texto seja sempre vis√≠vel */
                    .table tbody tr td {
                        color: var(--text-primary) !important;
                    }

                    .table tbody tr:hover {
                        background: rgba(99, 102, 241, 0.08);
                        border-color: rgba(99, 102, 241, 0.2);
                    }

                    .table td {
                        border-bottom: 1px solid var(--border-light);
                        padding: 1.25rem 1.5rem;
                        vertical-align: middle;
                        font-size: 0.9rem;
                        color: var(--text-primary);
                    }

                    .table tr:last-child td {
                        border-bottom: none;
                    }

                    /* Melhorar contraste do texto na tabela */
                    .table td a {
                        color: var(--text-primary) !important;
                        font-weight: 500;
                    }

                    .table td a:hover {
                        color: var(--primary) !important;
                    }

                    .table td .text-secondary {
                        color: var(--text-secondary) !important;
                    }

                    /* Nome do cliente - alto contraste m√°ximo */
                    .client-name-link {
                        color: #ffffff !important;
                        /* Branco puro para m√°ximo contraste */
                        font-weight: 700;
                        font-size: 0.95rem;
                        display: inline-block;
                        transition: all 0.2s ease;
                        letter-spacing: -0.2px;
                        line-height: 1.4;
                    }

                    .client-name-link:hover {
                        color: var(--primary) !important;
                    }

                    .client-email {
                        color: #cbd5e1 !important;
                        /* Slate 300 - cinza claro bem vis√≠vel */
                        font-weight: 400;
                        margin-top: 4px;
                        font-size: 0.85rem;
                        line-height: 1.4;
                    }

                    /* Garantir contraste mesmo em linhas alternadas e hover */
                    .table tbody tr .client-name-link,
                    .table tbody tr:nth-child(even) .client-name-link,
                    .table tbody tr:hover .client-name-link {
                        color: #ffffff !important;
                    }

                    .table tbody tr:hover .client-name-link:hover {
                        color: var(--primary) !important;
                    }

                    .table tbody tr .client-email,
                    .table tbody tr:nth-child(even) .client-email,
                    .table tbody tr:hover .client-email {
                        color: #cbd5e1 !important;
                    }

                    /* Garantir contraste em todas as c√©lulas */
                    .table td {
                        color: var(--text-primary) !important;
                    }

                    /* Container do cliente - melhor organiza√ß√£o */
                    .table td>.d-flex.align-items-center {
                        min-height: 42px;
                    }

                    .table td>.d-flex.align-items-center>div:last-child {
                        flex: 1;
                        min-width: 0;
                    }

                    .user-avatar {
                        width: 42px;
                        height: 42px;
                        background: linear-gradient(135deg, rgba(99, 102, 241, 0.25) 0%, rgba(139, 92, 246, 0.2) 100%);
                        color: var(--primary);
                        border-radius: 10px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 1rem;
                        font-weight: 700;
                        margin-right: 14px;
                        border: 1px solid rgba(99, 102, 241, 0.3);
                        flex-shrink: 0;
                        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                    }

                    .license-code {
                        font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
                        background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(99, 102, 241, 0.08) 100%);
                        padding: 6px 12px;
                        border-radius: 8px;
                        color: var(--primary);
                        font-size: 0.875rem;
                        font-weight: 600;
                        border: 1px solid rgba(99, 102, 241, 0.2);
                        letter-spacing: 0.5px;
                    }

                    .status-badge {
                        display: inline-flex;
                        align-items: center;
                        padding: 6px 12px;
                        border-radius: 8px;
                        font-size: 0.75rem;
                        font-weight: 600;
                        letter-spacing: 0.3px;
                        border: 1px solid transparent;
                    }

                    .status-active {
                        background: rgba(16, 185, 129, 0.15);
                        color: #10b981;
                        border-color: rgba(16, 185, 129, 0.3);
                    }

                    .status-blocked {
                        background: rgba(239, 68, 68, 0.15);
                        color: #ef4444;
                        border-color: rgba(239, 68, 68, 0.3);
                    }

                    /* Badge de plano na tabela */
                    .table .badge {
                        background: var(--bg-tertiary);
                        color: var(--text-primary);
                        border: 1px solid var(--border-light);
                        padding: 6px 12px;
                        font-weight: 500;
                        font-size: 0.75rem;
                    }

                    .domain-link {
                        color: #58a6ff;
                        text-decoration: none;
                    }

                    .domain-link:hover {
                        text-decoration: underline;
                    }

                    .empty-state {
                        padding: 4rem 1rem;
                        text-center;
                        color: var(--text-secondary);
                    }

                    /* Action Buttons */
                    .btn-action {
                        padding: 8px 12px;
                        font-size: 0.85rem;
                        border-radius: 8px;
                        border: 1px solid var(--border-light);
                        background: var(--bg-tertiary);
                        color: var(--text-primary);
                        transition: all 0.2s ease;
                        font-weight: 500;
                        min-width: 36px;
                        height: 36px;
                        display: inline-flex;
                        align-items: center;
                        justify-content: center;
                        text-decoration: none;
                    }

                    .btn-action i {
                        color: var(--text-primary);
                    }

                    .btn-action:hover {
                        background: var(--bg-card);
                        border-color: var(--primary);
                        color: var(--primary);
                        transform: translateY(-1px);
                        box-shadow: 0 2px 8px rgba(99, 102, 241, 0.2);
                    }

                    .btn-action.danger {
                        color: var(--text-primary);
                    }

                    .btn-action.danger:hover {
                        color: var(--danger);
                        border-color: var(--danger);
                        background: rgba(239, 68, 68, 0.1);
                    }

                    .btn-action.success {
                        color: var(--text-primary);
                    }

                    .btn-action.success:hover {
                        color: var(--success);
                        border-color: var(--success);
                        background: rgba(16, 185, 129, 0.1);
                    }

                    .form-control,
                    .form-select {
                        background: var(--bg-secondary) !important;
                        background-color: var(--bg-secondary) !important;
                        border: 1px solid var(--border-light);
                        color: var(--text-primary) !important;
                        border-radius: 8px;
                        padding: 0.75rem 1rem;
                        transition: all 0.2s ease;
                    }

                    /* GARANTIR QUE BACKGROUND PERMANE√áA ESCURO MESMO QUANDO PREENCHIDO */
                    .form-control:not(:placeholder-shown),
                    .form-control:valid,
                    .form-control:invalid,
                    .form-control[value]:not([value=""]),
                    .form-control:not([value=""]) {
                        background: var(--bg-secondary) !important;
                        background-color: var(--bg-secondary) !important;
                        color: var(--text-primary) !important;
                    }

                    /* GARANTIR QUE PLACEHOLDERS N√ÉO HERDEM A COR DO TEXTO E SEJAM SEMPRE BRANCOS */
                    .form-control::placeholder,
                    .form-control::-webkit-input-placeholder,
                    .form-control::-moz-placeholder,
                    .form-control:-ms-input-placeholder {
                        color: #ffffff !important;
                        opacity: 1 !important;
                        font-weight: 600 !important;
                        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.8) !important;
                    }

                    /* GARANTIR QUE PLACEHOLDERS SEJAM BRANCOS MESMO QUANDO INPUT TEM VALOR (para inputs vazios) */
                    .form-control:placeholder-shown::placeholder,
                    .form-control:placeholder-shown::-webkit-input-placeholder,
                    .form-control:placeholder-shown::-moz-placeholder,
                    .form-control:placeholder-shown:-ms-input-placeholder {
                        color: #ffffff !important;
                        opacity: 1 !important;
                        font-weight: 600 !important;
                        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.8) !important;
                    }

                    /* Placeholders com M√ÅXIMO CONTRASTE - BRANCO PURO */
                    input::placeholder,
                    input::-webkit-input-placeholder,
                    input::-moz-placeholder,
                    input:-ms-input-placeholder,
                    textarea::placeholder,
                    textarea::-webkit-input-placeholder,
                    textarea::-moz-placeholder,
                    textarea:-ms-input-placeholder {
                        color: #ffffff !important;
                        /* BRANCO PURO */
                        opacity: 1 !important;
                        font-weight: 500 !important;
                        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5) !important;
                    }

                    /* Placeholders para .form-control - BRANCO PURO */
                    .form-control::placeholder,
                    .form-control::-webkit-input-placeholder,
                    .form-control::-moz-placeholder,
                    .form-control:-ms-input-placeholder,
                    input.form-control::placeholder,
                    input.form-control::-webkit-input-placeholder,
                    input.form-control::-moz-placeholder,
                    input.form-control:-ms-input-placeholder {
                        color: #ffffff !important;
                        /* BRANCO PURO */
                        opacity: 1 !important;
                        font-weight: 500 !important;
                        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5) !important;
                    }

                    .form-control:focus::placeholder,
                    .form-control:focus::-webkit-input-placeholder,
                    .form-control:focus::-moz-placeholder,
                    .form-control:focus:-ms-input-placeholder {
                        color: #ffffff !important;
                        /* BRANCO PURO mesmo no foco */
                        opacity: 0.95 !important;
                    }

                    /* Placeholders para inputs de busca */
                    .form-control-search::placeholder,
                    .form-control-search::-webkit-input-placeholder,
                    .form-control-search::-moz-placeholder,
                    .form-control-search:-ms-input-placeholder {
                        color: #ffffff !important;
                        /* BRANCO PURO */
                        opacity: 1 !important;
                    }

                    /* For√ßar placeholder vis√≠vel em TODOS os inputs, especialmente password */
                    input[type="text"]::placeholder,
                    input[type="password"]::placeholder,
                    input[type="email"]::placeholder,
                    input[type="number"]::placeholder,
                    input[type="text"]::-webkit-input-placeholder,
                    input[type="password"]::-webkit-input-placeholder,
                    input[type="email"]::-webkit-input-placeholder,
                    input[type="number"]::-webkit-input-placeholder,
                    input[type="text"]::-moz-placeholder,
                    input[type="password"]::-moz-placeholder,
                    input[type="email"]::-moz-placeholder,
                    input[type="number"]::-moz-placeholder {
                        color: #ffffff !important;
                        /* BRANCO PURO */
                        opacity: 1 !important;
                        font-weight: 500 !important;
                        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5) !important;
                    }

                    /* ESPEC√çFICO para form-control password - M√ÅXIMA PRIORIDADE - FOR√áA ABSOLUTA */
                    input.form-control[type="password"]::placeholder,
                    input.form-control[type="password"]::-webkit-input-placeholder,
                    input.form-control[type="password"]::-moz-placeholder,
                    input.form-control[type="password"]:-ms-input-placeholder,
                    .form-control[type="password"]::placeholder,
                    .form-control[type="password"]::-webkit-input-placeholder,
                    .form-control[type="password"]::-moz-placeholder,
                    .form-control[type="password"]:-ms-input-placeholder,
                    input[type="password"].form-control::placeholder,
                    input[type="password"].form-control::-webkit-input-placeholder,
                    input[type="password"].form-control::-moz-placeholder,
                    input[type="password"].form-control:-ms-input-placeholder {
                        color: #ffffff !important;
                        /* BRANCO PURO - M√ÅXIMA VISIBILIDADE */
                        opacity: 1 !important;
                        font-weight: 500 !important;
                        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
                    }

                    /* ESPEC√çFICO para form-control text - M√ÅXIMA PRIORIDADE - FOR√áA ABSOLUTA */
                    input.form-control[type="text"]::placeholder,
                    input.form-control[type="text"]::-webkit-input-placeholder,
                    input.form-control[type="text"]::-moz-placeholder,
                    input.form-control[type="text"]:-ms-input-placeholder,
                    .form-control[type="text"]::placeholder,
                    .form-control[type="text"]::-webkit-input-placeholder,
                    .form-control[type="text"]::-moz-placeholder,
                    .form-control[type="text"]:-ms-input-placeholder,
                    input[type="text"].form-control::placeholder,
                    input[type="text"].form-control::-webkit-input-placeholder,
                    input[type="text"].form-control::-moz-placeholder,
                    input[type="text"].form-control:-ms-input-placeholder {
                        color: #ffffff !important;
                        /* BRANCO PURO - M√ÅXIMA VISIBILIDADE */
                        opacity: 1 !important;
                        font-weight: 500 !important;
                        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
                    }

                    /* SOBRESCREVER QUALQUER CSS DO BOOTSTRAP OU OUTRO FRAMEWORK */
                    .form-control::placeholder,
                    .form-control::-webkit-input-placeholder,
                    .form-control::-moz-placeholder,
                    .form-control:-ms-input-placeholder {
                        color: #ffffff !important;
                        /* BRANCO PURO */
                        opacity: 1 !important;
                        font-weight: 500 !important;
                    }

                    /* GARANTIR PARA TODOS OS INPUTS */
                    input::placeholder,
                    input::-webkit-input-placeholder,
                    input::-moz-placeholder,
                    input:-ms-input-placeholder {
                        color: #ffffff !important;
                        /* BRANCO PURO */
                        opacity: 1 !important;
                    }

                    .form-control:focus,
                    .form-select:focus {
                        background: var(--bg-card) !important;
                        background-color: var(--bg-card) !important;
                        border-color: var(--primary);
                        color: var(--text-primary) !important;
                        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
                        outline: none;
                    }

                    /* GARANTIR QUE BACKGROUND NUNCA MUDE PARA BRANCO - SOBRESCREVER BOOTSTRAP */
                    .form-control:not(:placeholder-shown),
                    .form-control:valid,
                    .form-control:invalid,
                    .form-control[value],
                    .form-control[value]:not([value=""]),
                    input.form-control:not([value=""]),
                    input.form-control[value] {
                        background: var(--bg-secondary) !important;
                        background-color: var(--bg-secondary) !important;
                        color: var(--text-primary) !important;
                    }

                    .form-select option {
                        background: var(--bg-secondary);
                        color: var(--text-primary);
                    }

                    /* Select pequeno na tabela */
                    .table .form-select-sm,
                    .table .plan-select {
                        background: var(--bg-tertiary);
                        border: 1px solid var(--border-light);
                        color: var(--text-primary) !important;
                        font-weight: 500;
                        min-height: 36px;
                    }

                    .table .form-select-sm:focus,
                    .table .plan-select:focus {
                        background: var(--bg-card);
                        border-color: var(--primary);
                        color: var(--text-primary) !important;
                        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
                    }

                    .table .form-select-sm option,
                    .table .plan-select option {
                        background: var(--bg-secondary);
                        color: var(--text-primary);
                        padding: 0.5rem;
                    }

                    /* Input Groups */
                    .input-group-text {
                        background: var(--bg-tertiary);
                        border: 1px solid var(--border-light);
                        color: var(--text-secondary);
                        border-radius: 8px;
                    }

                    /* Se√ß√£o de Filtros Moderna */
                    .filters-section {
                        background: var(--bg-tertiary);
                        border: 1px solid var(--border-light);
                        border-radius: 12px;
                        padding: 1.5rem;
                        margin-bottom: 1.5rem;
                    }

                    .filters-form {
                        display: flex;
                        gap: 1rem;
                        align-items: flex-end;
                        flex-wrap: wrap;
                    }

                    .filter-group {
                        flex: 1;
                        min-width: 200px;
                    }

                    .input-group-search {
                        position: relative;
                        display: flex;
                        align-items: center;
                    }

                    .input-group-search i {
                        position: absolute;
                        left: 1rem;
                        color: var(--text-secondary);
                        z-index: 1;
                    }

                    .form-control-search {
                        width: 100%;
                        background: var(--bg-secondary);
                        border: 1px solid var(--border-light);
                        color: var(--text-primary);
                        border-radius: 8px;
                        padding: 0.75rem 1rem 0.75rem 2.75rem;
                        font-size: 0.9rem;
                        transition: all 0.2s ease;
                    }

                    .form-control-search:focus {
                        background: var(--bg-card);
                        border-color: var(--primary);
                        color: var(--text-primary);
                        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
                        outline: none;
                    }

                    .form-control-search::placeholder,
                    .form-control-search::-webkit-input-placeholder,
                    .form-control-search::-moz-placeholder,
                    .form-control-search:-ms-input-placeholder {
                        color: #cbd5e1 !important;
                        /* Slate 300 - cinza claro bem vis√≠vel */
                        opacity: 1 !important;
                    }

                    .form-select-filter {
                        width: 100%;
                        background: var(--bg-secondary);
                        border: 1px solid var(--border-light);
                        color: var(--text-primary);
                        border-radius: 8px;
                        padding: 0.75rem 1rem;
                        font-size: 0.9rem;
                        cursor: pointer;
                        transition: all 0.2s ease;
                    }

                    .form-select-filter:focus {
                        background: var(--bg-card);
                        border-color: var(--primary);
                        color: var(--text-primary);
                        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
                        outline: none;
                    }

                    .form-select-filter option {
                        background: var(--bg-secondary);
                        color: var(--text-primary);
                    }

                    .filter-actions {
                        display: flex;
                        gap: 0.5rem;
                        align-items: center;
                    }

                    .btn-filter {
                        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
                        border: none;
                        color: #fff;
                        padding: 0.75rem 1.5rem;
                        border-radius: 8px;
                        font-size: 0.9rem;
                        font-weight: 600;
                        cursor: pointer;
                        display: inline-flex;
                        align-items: center;
                        gap: 0.5rem;
                        transition: all 0.2s ease;
                        box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
                    }

                    .btn-filter:hover {
                        transform: translateY(-1px);
                        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
                        background: linear-gradient(135deg, var(--primary-hover) 0%, var(--primary) 100%);
                    }

                    .btn-filter:active {
                        transform: translateY(0);
                    }

                    .btn-clear-filter {
                        background: var(--bg-secondary);
                        border: 1px solid var(--border-light);
                        color: var(--text-secondary);
                        width: 40px;
                        height: 40px;
                        border-radius: 8px;
                        display: inline-flex;
                        align-items: center;
                        justify-content: center;
                        text-decoration: none;
                        transition: all 0.2s ease;
                        cursor: pointer;
                    }

                    .btn-clear-filter:hover {
                        background: var(--bg-card);
                        border-color: var(--border);
                        color: var(--text-primary);
                        transform: translateY(-1px);
                    }

                    @media (max-width: 768px) {
                        .filters-form {
                            flex-direction: column;
                        }

                        .filter-group {
                            width: 100%;
                            min-width: auto;
                        }

                        .filter-actions {
                            width: 100%;
                        }

                        .btn-filter {
                            flex: 1;
                        }
                    }

                    .alert-info {
                        background: rgba(59, 130, 246, 0.15);
                        border-color: rgba(59, 130, 246, 0.4);
                        color: var(--info);
                    }

                    /* Pagination */
                    .pagination .page-link {
                        background: rgba(26, 31, 46, 0.6);
                        border: 1px solid rgba(30, 37, 50, 0.6);
                        color: var(--text-primary);
                        border-radius: 8px;
                        margin: 0 4px;
                        transition: all 0.3s ease;
                    }

                    .pagination .page-link:hover {
                        background: rgba(99, 102, 241, 0.1);
                        border-color: var(--primary);
                        color: var(--primary);
                        transform: translateY(-2px);
                    }

                    .pagination .page-item.active .page-link {
                        background: var(--primary);
                        border-color: var(--primary);
                        color: #fff;
                        font-weight: 700;
                    }

                    /* Alerts */
                    .alert {
                        border-radius: 12px;
                        border: 1px solid transparent;
                        backdrop-filter: blur(10px);
                    }

                    .alert-warning {
                        background: rgba(245, 158, 11, 0.15);
                        border-color: rgba(245, 158, 11, 0.4);
                        color: var(--warning);
                    }

                    .alert-danger {
                        background: rgba(255, 59, 48, 0.1);
                        border-color: rgba(255, 59, 48, 0.3);
                        color: var(--danger-color);
                    }

                    /* Smooth scroll */
                    html {
                        scroll-behavior: smooth;
                    }

                    /* Selection */
                    ::selection {
                        background: rgba(99, 102, 241, 0.3);
                        color: var(--text-primary);
                    }

                    /* Tabela Expans√≠vel */
                    .table-expandable .table-row-main {
                        cursor: pointer;
                        transition: background-color 0.2s ease;
                    }

                    .table-expandable .table-row-main:hover {
                        background-color: rgba(99, 102, 241, 0.05);
                    }

                    .table-expandable .table-row-main.expanded {
                        background-color: rgba(99, 102, 241, 0.08);
                    }

                    .btn-expand-row {
                        background: transparent;
                        border: none;
                        color: var(--text-secondary);
                        cursor: pointer;
                        padding: 0.5rem;
                        transition: all 0.2s ease;
                        border-radius: 6px;
                        width: 32px;
                        height: 32px;
                        display: inline-flex;
                        align-items: center;
                        justify-content: center;
                    }

                    .btn-expand-row:hover {
                        background: rgba(99, 102, 241, 0.15);
                        color: var(--primary);
                    }

                    .btn-expand-row i {
                        font-size: 0.75rem;
                    }

                    .btn-expand-row i {
                        transition: transform 0.2s ease;
                    }

                    .btn-expand-row.expanded i {
                        transform: rotate(90deg);
                    }

                    .table-row-details {
                        background-color: rgba(19, 23, 34, 0.5);
                    }

                    .row-details-content {
                        padding: 1.5rem;
                        background: linear-gradient(135deg, rgba(19, 23, 34, 0.6) 0%, rgba(26, 31, 46, 0.6) 100%);
                        border-radius: 12px;
                        border: 1px solid rgba(99, 102, 241, 0.2);
                    }

                    .detail-item {
                        display: flex;
                        align-items: center;
                        padding: 0.75rem 0;
                        border-bottom: 1px solid rgba(30, 37, 50, 0.3);
                    }

                    .detail-item:last-child {
                        border-bottom: none;
                    }

                    .detail-label {
                        font-weight: 600;
                        color: var(--text-secondary);
                        font-size: 0.85rem;
                        min-width: 180px;
                        display: flex;
                        align-items: center;
                    }

                    .detail-value {
                        color: var(--text-primary);
                        font-size: 0.9rem;
                        flex: 1;
                        display: flex;
                        align-items: center;
                        flex-wrap: wrap;
                        gap: 0.5rem;
                    }

                    @media (max-width: 768px) {
                        .detail-item {
                            flex-direction: column;
                            align-items: flex-start;
                            gap: 0.5rem;
                        }

                        .detail-label {
                            min-width: auto;
                        }
                    }
                </style>

                <!-- ESTILO FINAL PARA SOBRESCREVER BOOTSTRAP - PLACEHOLDERS BRANCOS E BACKGROUND ESCURO -->
                <!-- ESTE ESTILO DEVE SER O √öLTIMO PARA GARANTIR QUE SOBRESCREVA TUDO, INCLUINDO BOOTSTRAP -->
                <style id="final-placeholder-override" type="text/css">
                    /* FOR√áAR BACKGROUND ESCURO SEMPRE - SOBRESCREVER BOOTSTRAP COMPLETAMENTE COM VALORES FIXOS */
                    html body .form-control,
                    html body .form-control:not(:placeholder-shown),
                    html body .form-control:valid,
                    html body .form-control:invalid,
                    html body .form-control[value],
                    html body .form-control[value]:not([value=""]),
                    html body input.form-control,
                    html body input.form-control:not(:placeholder-shown),
                    html body input.form-control:valid,
                    html body input.form-control:invalid,
                    html body input.form-control[value],
                    html body input.form-control[value]:not([value=""]),
                    html body textarea.form-control,
                    html body textarea.form-control:not(:placeholder-shown) {
                        background: #1e293b !important;
                        background-color: #1e293b !important;
                        color: #f1f5f9 !important;
                    }

                    /* FOR√áAR PLACEHOLDERS BRANCOS - SOBRESCREVER BOOTSTRAP E QUALQUER OUTRO CSS COM VALORES FIXOS */
                    html body .form-control::placeholder,
                    html body .form-control::-webkit-input-placeholder,
                    html body .form-control::-moz-placeholder,
                    html body .form-control:-ms-input-placeholder,
                    html body input.form-control::placeholder,
                    html body input.form-control::-webkit-input-placeholder,
                    html body input.form-control::-moz-placeholder,
                    html body input.form-control:-ms-input-placeholder,
                    html body input[type="text"].form-control::placeholder,
                    html body input[type="text"].form-control::-webkit-input-placeholder,
                    html body input[type="text"].form-control::-moz-placeholder,
                    html body input[type="text"].form-control:-ms-input-placeholder,
                    html body input[type="password"].form-control::placeholder,
                    html body input[type="password"].form-control::-webkit-input-placeholder,
                    html body input[type="password"].form-control::-moz-placeholder,
                    html body input[type="password"].form-control:-ms-input-placeholder,
                    html body input[type="email"].form-control::placeholder,
                    html body input[type="email"].form-control::-webkit-input-placeholder,
                    html body input[type="email"].form-control::-moz-placeholder,
                    html body input[type="email"].form-control:-ms-input-placeholder,
                    html body input[type="number"].form-control::placeholder,
                    html body input[type="number"].form-control::-webkit-input-placeholder,
                    html body input[type="number"].form-control::-moz-placeholder,
                    html body input[type="number"].form-control:-ms-input-placeholder,
                    html body textarea.form-control::placeholder,
                    html body textarea.form-control::-webkit-input-placeholder,
                    html body textarea.form-control::-moz-placeholder,
                    html body textarea.form-control:-ms-input-placeholder {
                        color: #ffffff !important;
                        opacity: 1 !important;
                        font-weight: 600 !important;
                        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.8) !important;
                    }
                </style>

                <!-- ESTILO CR√çTICO FINAL - FOR√áA BRANCO ABSOLUTO NOS PLACEHOLDERS - DEVE SER O √öLTIMO ANTES DO </head> -->
                <style type="text/css">
                    /* FOR√áA ABSOLUTA - SOBRESCREVER QUALQUER CSS DO BOOTSTRAP OU OUTROS FRAMEWORKS */
                    /* Usando seletores com m√°xima especificidade e valores fixos */
                    html body form input.form-control::placeholder,
                    html body form input.form-control::-webkit-input-placeholder,
                    html body form input.form-control::-moz-placeholder,
                    html body form input.form-control:-ms-input-placeholder,
                    html body form textarea.form-control::placeholder,
                    html body form textarea.form-control::-webkit-input-placeholder,
                    html body form textarea.form-control::-moz-placeholder,
                    html body form textarea.form-control:-ms-input-placeholder,
                    html body div input.form-control::placeholder,
                    html body div input.form-control::-webkit-input-placeholder,
                    html body div input.form-control::-moz-placeholder,
                    html body div input.form-control:-ms-input-placeholder,
                    html body div textarea.form-control::placeholder,
                    html body div textarea.form-control::-webkit-input-placeholder,
                    html body div textarea.form-control::-moz-placeholder,
                    html body div textarea.form-control:-ms-input-placeholder,
                    html body .form-control::placeholder,
                    html body .form-control::-webkit-input-placeholder,
                    html body .form-control::-moz-placeholder,
                    html body .form-control:-ms-input-placeholder,
                    html body input[type="text"].form-control::placeholder,
                    html body input[type="text"].form-control::-webkit-input-placeholder,
                    html body input[type="text"].form-control::-moz-placeholder,
                    html body input[type="text"].form-control:-ms-input-placeholder,
                    html body input[type="password"].form-control::placeholder,
                    html body input[type="password"].form-control::-webkit-input-placeholder,
                    html body input[type="password"].form-control::-moz-placeholder,
                    html body input[type="password"].form-control:-ms-input-placeholder,
                    html body input[type="email"].form-control::placeholder,
                    html body input[type="email"].form-control::-webkit-input-placeholder,
                    html body input[type="email"].form-control::-moz-placeholder,
                    html body input[type="email"].form-control:-ms-input-placeholder,
                    html body input[type="number"].form-control::placeholder,
                    html body input[type="number"].form-control::-webkit-input-placeholder,
                    html body input[type="number"].form-control::-moz-placeholder,
                    html body input[type="number"].form-control:-ms-input-placeholder {
                        color: #ffffff !important;
                        opacity: 1 !important;
                        font-weight: 500 !important;
                    }

                    /* Garantir que inputs vazios mostrem placeholder branco */
                    html body input.form-control:placeholder-shown::placeholder,
                    html body input.form-control:placeholder-shown::-webkit-input-placeholder,
                    html body input.form-control:placeholder-shown::-moz-placeholder,
                    html body input.form-control:placeholder-shown:-ms-input-placeholder {
                        color: #ffffff !important;
                        opacity: 1 !important;
                    }
                </style>
</head>

<body>
    <div class="admin-layout">
        <%- include('partials/admin-sidebar', { currentPage: typeof currentPage !== 'undefined' ? currentPage : 'dashboard', notifications: typeof notifications !== 'undefined' ? notifications : null }) %>

            <!-- Conte√∫do Principal -->
            <div class="main-content">
                <!-- Navbar Superior -->
                <nav class="top-navbar">
                    <div class="top-navbar-content">
                        <div class="d-flex align-items-center gap-3">
                            <button class="menu-toggle"
                                onclick="document.querySelector('.sidebar').classList.toggle('open')"
                                style="background: transparent; border: 1px solid var(--border-light); color: var(--text-primary); padding: 0.5rem; border-radius: 8px; cursor: pointer; display: none;">
                                <i class="fa-solid fa-bars"></i>
                            </button>
                            <div class="breadcrumbs">
                                <a href="/admin">Dashboard</a>
                                <span class="separator">/</span>
                                <span class="current">Vis√£o Geral</span>
                            </div>
                        </div>
                        <div class="top-navbar-actions">
                            <button type="button" class="quick-action-btn" id="btnNovoCliente" data-bs-toggle="modal"
                                data-bs-target="#newClientModal">
                                <i class="fa-solid fa-plus"></i>
                                <span>Novo Cliente</span>
                            </button>
                            <div class="user-menu" id="userMenu">
                                <button class="user-menu-btn" onclick="toggleUserMenu()">
                                    <i class="fa-solid fa-user-circle"></i>
                                    <span>Admin</span>
                                    <i class="fa-solid fa-chevron-down" style="font-size: 0.75rem;"></i>
                                </button>
                                <div class="user-menu-dropdown">
                                    <a href="/admin" class="user-menu-item">
                                        <i class="fa-solid fa-user me-2"></i>Perfil
                                    </a>
                                    <a href="/admin" class="user-menu-item">
                                        <i class="fa-solid fa-gear me-2"></i>Configura√ß√µes
                                    </a>
                                    <a href="/logout" class="user-menu-item danger">
                                        <i class="fa-solid fa-right-from-bracket me-2"></i>Sair
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>

                <div class="container pb-5" style="padding: 2rem;">

                    <!-- Welcome Section -->
                    <div class="mb-5">
                        <h2 class="mb-2 text-white" style="font-weight: 800; letter-spacing: -1px; font-size: 2rem;">
                            Vis√£o Geral</h2>
                        <p class="text-secondary" style="font-size: 1rem; font-weight: 400;">Gerencie suas licen√ßas e
                            faturamento de forma eficiente.</p>
                    </div>

                    <!-- Stats Grid -->
                    <div class="row g-4 mb-4">
                        <!-- Card 1 -->
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div class="stat-label">Licen√ßas Ativas</div>
                                    <div class="stat-icon">
                                        <i class="fa-solid fa-circle-check"></i>
                                    </div>
                                </div>
                                <div class="stat-value highlight-success">
                                    <%= typeof stats !=='undefined' ? stats.activeLicenses : licenses.filter(l => l.active).length %>
                                </div>
                                <% if (typeof stats !=='undefined' && stats.activeLicensesTrend !== undefined && stats.activeLicensesTrend !== null) { const trend = stats.activeLicensesTrend; const trendClass = trend > 0 ? 'up' : trend < 0 ? 'down' : 'neutral'; const trendIcon = trend > 0 ? 'up' : trend < 0 ? 'down' : 'minus'; const trendValue = Math.abs(trend); %>
                                            <div class="stat-trend <%= trendClass %>">
                                                <i class="fa-solid fa-arrow-<%= trendIcon %>"></i>
                                                <span>
                                                    <%= trendValue %>% vs m√™s anterior
                                                </span>
                                            </div>
                                            <% } %>
                                                <a href="/admin?status=active" class="stat-link">
                                                    Ver detalhes <i class="fa-solid fa-arrow-right"></i>
                                                </a>
                            </div>
                        </div>

                        <!-- Card 2 -->
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div class="stat-label">Total de Clientes</div>
                                    <div class="stat-icon">
                                        <i class="fa-solid fa-users"></i>
                                    </div>
                                </div>
                                <div class="stat-value highlight-primary">
                                    <%= typeof stats !=='undefined' ? stats.totalLicenses : licenses.length %>
                                </div>
                                <% if (typeof stats !=='undefined' && stats.totalLicensesTrend !==undefined &&
                                    stats.totalLicensesTrend !==null) { const trend=stats.totalLicensesTrend; const
                                    trendClass=trend> 0 ? 'up' : trend < 0 ? 'down' : 'neutral' ; const trendIcon=trend>
                                        0 ? 'up' : trend < 0 ? 'down' : 'minus' ; const trendValue=Math.abs(trend); %>
                                            <div class="stat-trend <%= trendClass %>">
                                                <i class="fa-solid fa-arrow-<%= trendIcon %>"></i>
                                                <span>
                                                    <%= trendValue %>% vs m√™s anterior
                                                </span>
                                            </div>
                                            <% } %>
                                                <a href="/admin" class="stat-link">
                                                    Ver todos <i class="fa-solid fa-arrow-right"></i>
                                                </a>
                            </div>
                        </div>

                        <!-- Card 3 -->
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div class="stat-label">Receita Mensal Estimada</div>
                                    <div class="stat-icon">
                                        <i class="fa-solid fa-chart-line"></i>
                                    </div>
                                </div>
                                <div class="stat-value highlight-success">
                                    R$ <%= typeof stats !=='undefined' ?
                                        stats.estimatedMonthlyRevenue.toFixed(2).replace('.', ',' ) : (licenses.length *
                                        config.priceMonthly).toFixed(2).replace('.', ',' ) %>
                                </div>
                                <% if (typeof stats !=='undefined' && stats.revenueTrend !==undefined &&
                                    stats.revenueTrend !==null) { const trend=stats.revenueTrend; const
                                    trendClass=trend> 0 ? 'up' : trend < 0 ? 'down' : 'neutral' ; const trendIcon=trend>
                                        0 ? 'up' : trend < 0 ? 'down' : 'minus' ; const trendValue=Math.abs(trend); %>
                                            <div class="stat-trend <%= trendClass %>">
                                                <i class="fa-solid fa-arrow-<%= trendIcon %>"></i>
                                                <span>
                                                    <%= trendValue %>% vs m√™s anterior
                                                </span>
                                            </div>
                                            <% } %>
                                                <a href="/admin/vendas" class="stat-link">
                                                    Ver relat√≥rio <i class="fa-solid fa-arrow-right"></i>
                                                </a>
                            </div>
                        </div>

                        <!-- Card 4 -->
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div class="stat-label">Taxa de Convers√£o</div>
                                    <div class="stat-icon">
                                        <i class="fa-solid fa-percent"></i>
                                    </div>
                                </div>
                                <div class="stat-value highlight-info">
                                    <%= typeof stats !=='undefined' ? stats.conversionRate : '0' %>%
                                </div>
                                <% if (typeof stats !=='undefined' && stats.conversionTrend !==undefined &&
                                    stats.conversionTrend !==null) { const trend=stats.conversionTrend; const
                                    trendClass=trend> 0 ? 'up' : trend < 0 ? 'down' : 'neutral' ; const trendIcon=trend>
                                        0 ? 'up' : trend < 0 ? 'down' : 'minus' ; const trendValue=Math.abs(trend); %>
                                            <div class="stat-trend <%= trendClass %>">
                                                <i class="fa-solid fa-arrow-<%= trendIcon %>"></i>
                                                <span>
                                                    <%= trend !==0 ? trendValue + '% vs m√™s anterior' : 'Sem mudan√ßa' %>
                                                </span>
                                            </div>
                                            <% } %>
                                                <a href="/admin/vendas" class="stat-link">
                                                    Ver an√°lise <i class="fa-solid fa-arrow-right"></i>
                                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Alertas de Trials Expirando -->
                    <% if (typeof stats !=='undefined' && (stats.expiringTrialsCount > 0 || stats.expiredTrialsCount > 0)) { %>
                        <div class="content-card mb-4"
                            style="border: 2px solid <%= stats.expiredTrialsCount > 0 ? 'var(--danger)' : 'var(--warning)' %> !important;">
                            <div class="card-header-custom">
                                <div class="card-title">
                                    <i class="fa-solid fa-exclamation-triangle me-2"
                                        style="color: <%= stats.expiredTrialsCount > 0 ? 'var(--danger)' : 'var(--warning)' %>;"></i>
                                    Alertas de Trials
                                </div>
                            </div>
                            <div class="p-4" style="padding: 1.5rem 2rem !important;">
                                <% if (stats.expiredTrialsCount> 0) { %>
                                    <div class="alert alert-danger d-flex align-items-center mb-3"
                                        style="padding: 1rem 1.25rem;">
                                        <i class="fa-solid fa-ban me-2"></i>
                                        <div>
                                            <strong>
                                                <%= stats.expiredTrialsCount %>
                                            </strong> trial(s) expirado(s) ainda ativo(s).
                                            <a href="/admin?plan=trial&amp;status=active"
                                                class="text-decoration-none ms-2"
                                                style="color: inherit; text-decoration: underline !important;">
                                                Ver trials expirados <i class="fa-solid fa-arrow-right ms-1"></i>
                                            </a>
                                        </div>
                                    </div>
                                    <% } %>
                                        <% if (stats.expiringTrialsCount> 0) { %>
                                            <div class="alert d-flex align-items-center mb-0"
                                                style="background: rgba(245, 158, 11, 0.15); border-color: rgba(245, 158, 11, 0.4); color: var(--warning); padding: 1rem 1.25rem;">
                                                <i class="fa-solid fa-clock me-2"></i>
                                                <div>
                                                    <strong>
                                                        <%= stats.expiringTrialsCount %>
                                                    </strong> trial(s) expirando nos pr√≥ximos 3 dias.
                                                    <a href="/admin?plan=trial&amp;status=active"
                                                        class="text-decoration-none ms-2"
                                                        style="color: inherit; text-decoration: underline !important;">
                                                        Ver trials expirando <i
                                                            class="fa-solid fa-arrow-right ms-1"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <% } %>
                            </div>
                        </div>
                        <% } %>

                            <!-- Gr√°ficos -->
                            <div class="row g-4 mb-4">
                                <!-- Gr√°fico de Receita ao Longo do Tempo -->
                                <div class="col-md-8">
                                    <div class="content-card">
                                        <div class="card-title">
                                            <i class="fa-solid fa-chart-line me-2 text-secondary"></i>
                                            Receita Mensal Estimada
                                        </div>
                                        <canvas id="revenueChart" style="max-height: 300px;"></canvas>
                                    </div>
                                </div>

                                <!-- Distribui√ß√£o de Planos -->
                                <div class="col-md-4">
                                    <div class="content-card">
                                        <div class="card-title">
                                            <i class="fa-solid fa-chart-pie me-2 text-secondary"></i>
                                            Distribui√ß√£o de Planos
                                        </div>
                                        <canvas id="planChart" style="max-height: 300px;"></canvas>
                                    </div>
                                </div>
                            </div>

                            <!-- Gr√°fico de Novos Clientes -->
                            <div class="row g-4 mb-4">
                                <div class="col-md-12">
                                    <div class="content-card">
                                        <div class="card-title">
                                            <i class="fa-solid fa-user-plus me-2 text-secondary"></i>
                                            Novos Clientes por M√™s (√öltimos 6 Meses)
                                        </div>
                                        <canvas id="clientsChart" style="max-height: 300px;"></canvas>
                                    </div>
                                </div>
                            </div>

                            <!-- Notifica√ß√µes N√£o Lidas -->
                            <% if (typeof notifications !=='undefined' && notifications.unread &&
                                notifications.unread.length> 0) { %>
                                <div class="content-card mb-4" style="border: 2px solid var(--info) !important;">
                                    <div class="card-header-custom d-flex justify-content-between align-items-center">
                                        <div class="card-title">
                                            <i class="fa-solid fa-bell me-2" style="color: var(--info);"></i>
                                            Notifica√ß√µes Pendentes (<%= notifications.totalUnread %>)
                                        </div>
                                        <a href="/admin/notifications" class="btn btn-sm btn-nav">
                                            Ver Todas <i class="fa-solid fa-arrow-right ms-1"></i>
                                        </a>
                                    </div>
                                    <div class="p-4" style="padding: 1.5rem 2rem !important;">
                                        <% notifications.unread.slice(0, 5).forEach(function(notif) { %>
                                            <div class="d-flex justify-content-between align-items-start mb-3 pb-3 border-bottom border-secondary"
                                                style="<%= notif === notifications.unread[notifications.unread.length - 1] ? 'border-bottom: none !important; margin-bottom: 0 !important; padding-bottom: 0 !important;' : '' %>">
                                                <div class="flex-grow-1">
                                                    <div class="d-flex align-items-center mb-1">
                                                        <% if (notif.type==='payment_failed' ) { %>
                                                            <i class="fa-solid fa-credit-card text-danger me-2"></i>
                                                            <% } else if (notif.type==='subscription_cancelled' ) { %>
                                                                <i class="fa-solid fa-ban me-2"
                                                                    style="color: var(--warning);"></i>
                                                                <% } else if (notif.type==='trial_expiring' ) { %>
                                                                    <i class="fa-solid fa-clock me-2"
                                                                        style="color: var(--warning);"></i>
                                                                    <% } else { %>
                                                                        <i
                                                                            class="fa-solid fa-info-circle text-info me-2"></i>
                                                                        <% } %>
                                                                            <strong class="text-white">
                                                                                <%= notif.title %>
                                                                            </strong>
                                                                            <span class="badge bg-secondary ms-2"
                                                                                style="font-size: 0.7rem;">
                                                                                <%= new
                                                                                    Date(notif.createdAt).toLocaleDateString('pt-BR')
                                                                                    %>
                                                                            </span>
                                                    </div>
                                                    <p class="text-secondary mb-0" style="font-size: 0.85rem;">
                                                        <%= notif.message %>
                                                    </p>
                                                    <% if (notif.email) { %>
                                                        <a href="/admin/client/<%= encodeURIComponent(notif.email) %>"
                                                            class="text-decoration-none mt-1 d-inline-block"
                                                            style="color: #58a6ff; font-size: 0.8rem;">
                                                            Ver cliente <i class="fa-solid fa-external-link-alt ms-1"
                                                                style="font-size: 0.7rem;"></i>
                                                        </a>
                                                        <% } %>
                                                </div>
                                                <button class="btn btn-sm btn-action ms-2"
                                                    onclick="markAsRead('<%= notif._id %>')" title="Marcar como lida">
                                                    <i class="fa-solid fa-check"></i>
                                                </button>
                                            </div>
                                            <% }); %>
                                    </div>
                                </div>
                                <% } %>

                                    <!-- Settings Section -->
                                    <div class="content-card mb-4" id="config-section">
                                        <div class="card-header-custom">
                                            <div class="card-title">
                                                <i class="fa-solid fa-cog me-2 text-secondary"></i>
                                                Configura√ß√µes de Vendas
                                            </div>
                                        </div>
                                        <div class="p-4" style="padding: 2rem !important;">
                                            <form action="/admin/update-config" method="POST">
                                                <% if (typeof csrfToken !=='undefined' && csrfToken) { %>
                                                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                                    <% } %>
                                                        <div class="row g-4 mb-4">
                                                            <div class="col-md-3">
                                                                <label class="form-label text-secondary small mb-2">Dias
                                                                    de Teste (Trial)</label>
                                                                <div class="input-group">
                                                                    <input type="number" name="trialDays"
                                                                        class="form-control"
                                                                        value="<%= config.trialDays || 7 %>">
                                                                    <span class="input-group-text">Dias</span>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label
                                                                    class="form-label text-secondary small mb-2">Pre√ßo
                                                                    Mensal</label>
                                                                <div class="input-group">
                                                                    <span class="input-group-text">R$</span>
                                                                    <input type="number" name="priceMonthly" step="0.01"
                                                                        class="form-control"
                                                                        value="<%= config.priceMonthly || 97.00 %>">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label
                                                                    class="form-label text-secondary small mb-2">Pre√ßo
                                                                    Anual</label>
                                                                <div class="input-group">
                                                                    <span class="input-group-text">R$</span>
                                                                    <input type="number" name="priceYearly" step="0.01"
                                                                        class="form-control"
                                                                        value="<%= config.priceYearly || 997.00 %>">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label
                                                                    class="form-label text-secondary small mb-2">Texto
                                                                    Promocional</label>
                                                                <input type="text" name="promoText" class="form-control"
                                                                    value="<%= config.promoText || 'Oferta de Lan√ßamento' %>">
                                                            </div>
                                                        </div>

                                                        <!-- Stripe Configuration -->
                                                        <div class="mt-5 pt-5 border-top"
                                                            style="border-color: var(--border-light) !important;">
                                                            <h6 class="text-white mb-4"
                                                                style="font-weight: 600; font-size: 1rem;">
                                                                <i class="fa-brands fa-stripe me-2"
                                                                    style="color: var(--primary);"></i>
                                                                Configura√ß√£o Stripe
                                                            </h6>
                                                            <div class="row g-4">
                                                                <div class="col-md-4">
                                                                    <label class="form-label text-secondary small mb-2">
                                                                        Stripe Secret Key
                                                                        <i class="fa-solid fa-info-circle ms-1"
                                                                            data-bs-toggle="tooltip"
                                                                            title="Chave secreta do Stripe (sk_live_... ou sk_test_...)"></i>
                                                                    </label>
                                                                    <input type="password" name="stripeSecretKey"
                                                                        class="form-control"
                                                                        value="<%= config.stripeSecretKey || '' %>"
                                                                        placeholder="sk_live_... ou sk_test_..."
                                                                        style="color: var(--text-primary);"
                                                                        data-placeholder-color="#ffffff">
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <label class="form-label text-secondary small mb-2">
                                                                        Stripe Publishable Key
                                                                        <i class="fa-solid fa-info-circle ms-1"
                                                                            data-bs-toggle="tooltip"
                                                                            title="Chave p√∫blica do Stripe (pk_live_... ou pk_test_...)"></i>
                                                                    </label>
                                                                    <input type="text" name="stripePublishableKey"
                                                                        class="form-control"
                                                                        value="<%= config.stripePublishableKey || '' %>"
                                                                        placeholder="pk_live_... ou pk_test_..."
                                                                        style="color: var(--text-primary);"
                                                                        data-placeholder-color="#ffffff">
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <label class="form-label text-secondary small mb-2">
                                                                        Webhook Secret
                                                                        <i class="fa-solid fa-info-circle ms-1"
                                                                            data-bs-toggle="tooltip"
                                                                            title="Secret do webhook do Stripe (whsec_...)"></i>
                                                                    </label>
                                                                    <input type="password" name="stripeWebhookSecret"
                                                                        class="form-control"
                                                                        value="<%= config.stripeWebhookSecret || '' %>"
                                                                        placeholder="whsec_..."
                                                                        style="color: var(--text-primary);"
                                                                        data-placeholder-color="#ffffff">
                                                                    <small class="text-secondary d-block mt-2"
                                                                        style="font-size: 0.75rem;">URL do webhook:
                                                                        <code
                                                                            style="color: var(--primary);">http://seu-dominio.com/webhook/stripe</code></small>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-12 text-end mt-5">
                                                            <button type="submit" class="btn btn-accent">
                                                                <i class="fa-solid fa-save me-2"></i> Salvar Altera√ß√µes
                                                            </button>
                                                        </div>
                                            </form>
                                        </div>
                                    </div>

                                    <!-- Gerenciamento de Produtos -->
                                    <div class="content-card mb-4" id="products-section">
                                        <div class="card-header-custom">
                                            <div class="card-title">
                                                <i class="fa-solid fa-box me-2 text-secondary"></i>
                                                Gerenciamento de Produtos
                                            </div>
                                            <button type="button" class="btn btn-sm btn-accent" onclick="openNewProductModal()">
                                                <i class="fa-solid fa-plus me-1"></i> Novo Produto
                                            </button>
                                        </div>
                                        <div class="p-4" style="padding: 2rem !important;">
                                            <div class="alert alert-info mb-4" style="background: rgba(59, 130, 246, 0.15); border-color: rgba(59, 130, 246, 0.4); color: var(--info); padding: 1rem 1.25rem;">
                                                <i class="fa-solid fa-info-circle me-2"></i>
                                                <strong>Produtos:</strong> Gerencie m√∫ltiplos plugins/produtos. Cada produto pode ter seus pr√≥prios pre√ßos, trial days e configura√ß√µes.
                                            </div>
                                            
                                            <!-- Lista de Produtos -->
                                            <div id="products-list">
                                                <div class="table-responsive">
                                                    <table class="table table-dark table-hover">
                                                        <thead>
                                                            <tr>
                                                                <th>Nome</th>
                                                                <th>Slug</th>
                                                                <th>Trial</th>
                                                                <th>Pre√ßo Mensal</th>
                                                                <th>Pre√ßo Anual</th>
                                                                <th>Status</th>
                                                                <th>Ordem</th>
                                                                <th>A√ß√µes</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="products-table-body">
                                                            <% 
                                                            const productsToShow = typeof allProducts !== 'undefined' ? allProducts : [];
                                                            if (productsToShow && productsToShow.length > 0) {
                                                                productsToShow.forEach(function(product) { %>
                                                                    <tr data-product-id="<%= product._id %>">
                                                                        <td>
                                                                            <strong><%= product.name %></strong>
                                                                            <% if (product.description) { %>
                                                                                <br><small class="text-secondary"><%= product.description.substring(0, 50) %><%= product.description.length > 50 ? '...' : '' %></small>
                                                                            <% } %>
                                                                        </td>
                                                                        <td><code class="text-primary"><%= product.slug %></code></td>
                                                                        <td><%= product.trialDays || 7 %> dias</td>
                                                                        <td>R$ <%= (product.priceMonthly || 0).toFixed(2).replace('.', ',') %></td>
                                                                        <td>R$ <%= (product.priceYearly || 0).toFixed(2).replace('.', ',') %></td>
                                                                        <td>
                                                                            <% if (product.active) { %>
                                                                                <span class="badge bg-success">Ativo</span>
                                                                            <% } else { %>
                                                                                <span class="badge bg-secondary">Inativo</span>
                                                                            <% } %>
                                                                        </td>
                                                                        <td><%= product.order || 0 %></td>
                                                                        <td>
                                                                            <button class="btn btn-sm btn-primary me-1" onclick="editProduct('<%= product._id %>')" title="Editar">
                                                                                <i class="fa-solid fa-edit"></i>
                                                                            </button>
                                                                            <button class="btn btn-sm btn-danger" onclick="deleteProduct('<%= product._id %>', '<%= product.name %>')" title="Deletar">
                                                                                <i class="fa-solid fa-trash"></i>
                                                                            </button>
                                                                        </td>
                                                                    </tr>
                                                                <% });
                                                            } else { %>
                                                                <tr>
                                                                    <td colspan="8" class="text-center text-secondary py-4">
                                                                        <i class="fa-solid fa-box-open fa-2x mb-3 d-block"></i>
                                                                        Nenhum produto cadastrado. Clique em "Novo Produto" para come√ßar.
                                                                    </td>
                                                                </tr>
                                                            <% } %>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Configura√ß√£o de Email -->
                                    <div class="content-card mb-4">
                                        <div class="card-header-custom">
                                            <div class="card-title">
                                                <i class="fa-solid fa-envelope me-2 text-secondary"></i>
                                                Configura√ß√£o de Email
                                            </div>
                                        </div>
                                        <div class="p-4" style="padding: 2rem !important;">
                                            <form action="/admin/update-config" method="POST">
                                                <% if (typeof csrfToken !=='undefined' && csrfToken) { %>
                                                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                                    <% } %>
                                                        <div class="alert alert-info mb-4"
                                                            style="background: rgba(59, 130, 246, 0.15); border-color: rgba(59, 130, 246, 0.4); color: var(--info); padding: 1rem 1.25rem;">
                                                            <i class="fa-solid fa-info-circle me-2"></i>
                                                            <strong>Importante:</strong> Configure o SMTP para enviar
                                                            emails autom√°ticos com chaves de licen√ßa.
                                                            Se n√£o configurar, as chaves ser√£o apenas exibidas na tela.
                                                            Para Gmail, use "Senha de App" ao inv√©s da senha normal.
                                                        </div>

                                                        <div class="row g-4">
                                                            <div class="col-md-6">
                                                                <label
                                                                    class="form-label text-secondary small mb-2">Servidor
                                                                    SMTP:</label>
                                                                <input type="text" name="smtpHost" class="form-control"
                                                                    value="<%= config.emailConfig && config.emailConfig.smtpHost ? config.emailConfig.smtpHost : '' %>"
                                                                    placeholder="smtp.gmail.com">
                                                                <small class="text-secondary d-block mt-1"
                                                                    style="font-size: 0.75rem;">Ex: smtp.gmail.com,
                                                                    smtp.outlook.com</small>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label
                                                                    class="form-label text-secondary small mb-2">Porta:</label>
                                                                <input type="number" name="smtpPort"
                                                                    class="form-control"
                                                                    value="<%= config.emailConfig && config.emailConfig.smtpPort ? config.emailConfig.smtpPort : 587 %>"
                                                                    placeholder="587">
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label
                                                                    class="form-label text-secondary small mb-2">SSL/TLS:</label>
                                                                <select name="smtpSecure" class="form-select">
                                                                    <option value="false" <%=!config.emailConfig ||
                                                                        !config.emailConfig.smtpSecure ? 'selected' : ''
                                                                        %>>N√£o (TLS)</option>
                                                                    <option value="true" <%=config.emailConfig &&
                                                                        config.emailConfig.smtpSecure ? 'selected' : ''
                                                                        %>>Sim (SSL)</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label
                                                                    class="form-label text-secondary small mb-2">Usu√°rio
                                                                    SMTP:</label>
                                                                <input type="text" name="smtpUser" class="form-control"
                                                                    value="<%= config.emailConfig && config.emailConfig.smtpUser ? config.emailConfig.smtpUser : '' %>"
                                                                    placeholder="seu-email@gmail.com">
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label
                                                                    class="form-label text-secondary small mb-2">Senha
                                                                    SMTP:</label>
                                                                <input type="password" name="smtpPassword"
                                                                    class="form-control" value=""
                                                                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                                                <small class="text-secondary d-block mt-1"
                                                                    style="font-size: 0.75rem;">Deixe em branco para n√£o
                                                                    alterar</small>
                                                            </div>
                                                            <div class="col-md-12">
                                                                <label
                                                                    class="form-label text-secondary small mb-2">Email
                                                                    Remetente:</label>
                                                                <input type="email" name="fromEmail"
                                                                    class="form-control"
                                                                    value="<%= config.emailConfig && config.emailConfig.fromEmail ? config.emailConfig.fromEmail : '' %>"
                                                                    placeholder="noreply@seudominio.com">
                                                                <small class="text-secondary d-block mt-1"
                                                                    style="font-size: 0.75rem;">Email que aparecer√° como
                                                                    remetente</small>
                                                            </div>
                                                            <div class="col-md-12 mt-2">
                                                                <button type="submit" class="btn btn-accent">
                                                                    <i class="fa-solid fa-save me-2"></i>Salvar
                                                                    Configura√ß√µes de Email
                                                                </button>
                                                            </div>
                                                        </div>
                                            </form>
                                        </div>
                                    </div>

                                    <!-- Main Table -->
                                    <div class="content-card">
                                        <div class="card-header-custom">
                                            <div class="card-title">
                                                <i class="fa-solid fa-list-ul me-2 text-secondary"></i>
                                                Assinaturas
                                                <% if (typeof pagination !=='undefined' && pagination.totalLicenses> 0)
                                                    { %>
                                                    <span class="text-secondary"
                                                        style="font-size: 0.85rem; font-weight: normal;">
                                                        (<%= pagination.totalLicenses %> total)
                                                    </span>
                                                    <% } %>
                                            </div>

                                            <div class="d-flex gap-2">
                                                <a href="/admin/notifications"
                                                    class="btn btn-nav btn-sm position-relative" title="Notifica√ß√µes">
                                                    <i class="fa-solid fa-bell me-1"></i> Notifica√ß√µes
                                                    <% if (typeof notifications !=='undefined' &&
                                                        notifications.totalUnread> 0) { %>
                                                        <span
                                                            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                                                            style="font-size: 0.65rem;">
                                                            <%= notifications.totalUnread> 99 ? '99+' :
                                                                notifications.totalUnread %>
                                                        </span>
                                                        <% } %>
                                                </a>
                                                <a href="/admin/activity-log" class="btn btn-nav btn-sm"
                                                    title="Ver log de atividades">
                                                    <i class="fa-solid fa-history me-1"></i> Log de Atividades
                                                </a>
                                                <a href="/admin/export-csv" class="btn btn-nav btn-sm"
                                                    title="Exportar lista de clientes">
                                                    <i class="fa-solid fa-file-csv me-1"></i> Exportar CSV
                                                </a>
                                                <button type="button" class="btn btn-nav btn-sm" id="btnCriarTeste"
                                                    onclick="if(typeof window.openNewClientModal==='function'){window.openNewClientModal();}else{console.error('openNewClientModal n√£o dispon√≠vel');alert('Erro: Fun√ß√£o n√£o dispon√≠vel. Recarregue a p√°gina.');}return false;">
                                                    <i class="fa-solid fa-plus me-1"></i> Criar Teste
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Busca e Filtros -->
                                        <div class="filters-section">
                                            <form method="GET" action="/admin" class="filters-form">
                                                <!-- Campo de Busca -->
                                                <div class="filter-group">
                                                    <div class="input-group-search">
                                                        <i class="fa-solid fa-search"></i>
                                                        <input type="text" name="search" class="form-control-search"
                                                            placeholder="Buscar por email ou dom√≠nio..."
                                                            value="<%= typeof search !== 'undefined' ? search : '' %>">
                                                    </div>
                                                </div>

                                                <!-- Filtro por Status -->
                                                <div class="filter-group">
                                                    <select name="status" class="form-select-filter">
                                                        <option value="all" <%=typeof filterStatus !=='undefined' &&
                                                            filterStatus==='all' ? 'selected' : '' %>>Todos os Status
                                                        </option>
                                                        <option value="active" <%=typeof filterStatus !=='undefined' &&
                                                            filterStatus==='active' ? 'selected' : '' %>>Apenas Ativos
                                                        </option>
                                                        <option value="blocked" <%=typeof filterStatus !=='undefined' &&
                                                            filterStatus==='blocked' ? 'selected' : '' %>>Apenas
                                                            Bloqueados</option>
                                                    </select>
                                                </div>

                                                <!-- Filtro por Plano -->
                                                <div class="filter-group">
                                                    <select name="plan" class="form-select-filter">
                                                        <option value="all" <%=typeof filterPlan !=='undefined' &&
                                                            filterPlan==='all' ? 'selected' : '' %>>Todos os Planos
                                                        </option>
                                                        <option value="trial" <%=typeof filterPlan !=='undefined' &&
                                                            filterPlan==='trial' ? 'selected' : '' %>>Trial</option>
                                                        <option value="monthly" <%=typeof filterPlan !=='undefined' &&
                                                            filterPlan==='monthly' ? 'selected' : '' %>>Mensal</option>
                                                        <option value="yearly" <%=typeof filterPlan !=='undefined' &&
                                                            filterPlan==='yearly' ? 'selected' : '' %>>Anual</option>
                                                    </select>
                                                </div>

                                                <!-- Bot√µes -->
                                                <div class="filter-actions">
                                                    <button type="submit" class="btn-filter">
                                                        <i class="fa-solid fa-filter"></i>
                                                        Filtrar
                                                    </button>
                                                    <a href="/admin" class="btn-clear-filter" title="Limpar filtros">
                                                        <i class="fa-solid fa-times"></i>
                                                    </a>
                                                </div>
                                            </form>
                                        </div>

                                        <div class="table-responsive table-container"
                                            style="background: var(--bg-card) !important;">
                                            <table class="table table-expandable"
                                                style="background: var(--bg-card) !important;">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 40px;"></th>
                                                        <th>Cliente</th>
                                                        <th>Chave de Licen√ßa</th>
                                                        <th>Plano</th>
                                                        <th>Status</th>
                                                        <th class="text-end">A√ß√µes</th>
                                                    </tr>
                                                </thead>
                                                <tbody style="background: var(--bg-card) !important;">
                                                    <% if (licenses.length===0) { %>
                                                        <tr style="background: var(--bg-secondary) !important;">
                                                            <td colspan="6" style="background: transparent !important;">
                                                                <div class="empty-state">
                                                                    <i
                                                                        class="fa-solid fa-inbox fa-2x mb-3 opacity-25"></i>
                                                                    <p class="m-0">Nenhuma licen√ßa encontrada.</p>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <% } else { %>
                                                            <% licenses.forEach(function(license, index) {
                                                                // Calcular data de expira√ß√£o
                                                                let expiresAt = null;
                                                                let daysLeft = 0;
                                                                let isExpired = false;
                                                                let isExpiringSoon = false;
                                                                
                                                                if (license.plan === 'trial' && license.trialExpiresAt) {
                                                                    expiresAt = new Date(license.trialExpiresAt);
                                                                } else if ((license.plan === 'monthly' || license.plan === 'yearly') && license.planExpiresAt) {
                                                                    expiresAt = new Date(license.planExpiresAt);
                                                                }
                                                                
                                                                if (expiresAt) {
                                                                    const now = new Date();
                                                                    daysLeft = Math.ceil((expiresAt - now) / (1000 * 60 * 60 * 24));
                                                                    isExpired = daysLeft <= 0;
                                                                    isExpiringSoon = daysLeft <= 7 && daysLeft > 0;
                                                                }

                                                                // Produto
                                                                let productName = 'Padr√£o';
                                                                if (license.productId && typeof license.productId === 'object' && license.productId.name) {
                                                                    productName = license.productId.name;
                                                                }
                                                                %>
                                                                <tr class="table-row-main"
                                                                    data-license-id="license-<%= index %>"
                                                                    style="background: var(--bg-secondary) !important;">
                                                                    <td style="background: transparent !important;">
                                                                        <button class="btn-expand-row"
                                                                            onclick="toggleRowDetails('<%= index %>')"
                                                                            aria-label="Expandir detalhes">
                                                                            <i class="fa-solid fa-chevron-right"></i>
                                                                        </button>
                                                                    </td>
                                                                    <td style="background: transparent !important;">
                                                                        <div class="d-flex align-items-center">
                                                                            <div class="user-avatar">
                                                                                <%= license.email.charAt(0).toUpperCase()
                                                                                    %>
                                                                            </div>
                                                                            <div>
                                                                                <a href="/admin/client/<%= encodeURIComponent(license.email) %>"
                                                                                    class="client-name-link text-decoration-none"
                                                                                    title="Ver detalhes do cliente">
                                                                                    <%= license.email.split('@')[0] %>
                                                                                        <i class="fa-solid fa-external-link-alt ms-1"
                                                                                            style="font-size: 0.7rem; opacity: 0.5;"></i>
                                                                                </a>
                                                                                <div class="client-email">
                                                                                    <%= license.email %>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                    <td style="background: transparent !important;">
                                                                        <div class="d-flex align-items-center gap-2">
                                                                            <code
                                                                                style="background: rgba(99, 102, 241, 0.15); color: var(--primary); padding: 4px 8px; border-radius: 6px; font-size: 0.75rem; font-weight: 600; border: 1px solid rgba(99, 102, 241, 0.3); max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                                                                                title="<%= license.key %>">
                                                <%= license.key %>
                                            </code>
                                                                            <button class="btn btn-sm btn-action"
                                                                                onclick="copyKey('<%= license.key %>')"
                                                                                title="Copiar chave"
                                                                                style="padding: 2px 6px;">
                                                                                <i class="fa-solid fa-copy"
                                                                                    style="font-size: 0.7rem;"></i>
                                                                            </button>
                                                                        </div>
                                                                    </td>
                                                                    <td style="background: transparent !important;">
                                                                        <form action="/admin/change-plan" method="POST"
                                                                            onchange="this.submit()"
                                                                            onclick="event.stopPropagation();">
                                                                            <% if (typeof csrfToken !=='undefined' &&
                                                                                csrfToken) { %>
                                                                                <input type="hidden" name="_csrf"
                                                                                    value="<%= csrfToken %>">
                                                                                <% } %>
                                                                                    <input type="hidden" name="email"
                                                                                        value="<%= license.email %>">
                                                                                    <select name="newPlan"
                                                                                        class="form-select form-select-sm plan-select"
                                                                                        style="width: 110px; font-size: 0.8rem; font-weight: 500;">
                                                                                        <option value="trial"
                                                                                            <%=license.plan==='trial'
                                                                                            ? 'selected' : '' %>>Trial
                                                                                        </option>
                                                                                        <option value="monthly"
                                                                                            <%=license.plan==='monthly'
                                                                                            ? 'selected' : '' %>>Mensal
                                                                                        </option>
                                                                                        <option value="yearly"
                                                                                            <%=license.plan==='yearly'
                                                                                            ? 'selected' : '' %>>Anual
                                                                                        </option>
                                                                                    </select>
                                                                        </form>
                                                                    </td>
                                                                    <td style="background: transparent !important;">
                                                                        <% if (license.active) { %>
                                                                            <span class="status-badge status-active">
                                                                                <i class="fa-solid fa-check me-1"
                                                                                    style="font-size: 0.7rem;"></i>
                                                                                Ativo
                                                                            </span>
                                                                            <% } else { %>
                                                                                <span
                                                                                    class="status-badge status-blocked">
                                                                                    <i class="fa-solid fa-ban me-1"
                                                                                        style="font-size: 0.7rem;"></i>
                                                                                    Bloqueado
                                                                                </span>
                                                                                <% } %>
                                                                    </td>
                                                                    <td class="text-end"
                                                                        style="background: transparent !important;">
                                                                        <div class="d-flex gap-1 justify-content-end"
                                                                            onclick="event.stopPropagation();">
                                                                            <form action="/toggle-license" method="POST"
                                                                                style="display:inline;">
                                                                                <% if (typeof csrfToken !=='undefined'
                                                                                    && csrfToken) { %>
                                                                                    <input type="hidden" name="_csrf"
                                                                                        value="<%= csrfToken %>">
                                                                                    <% } %>
                                                                                        <input type="hidden"
                                                                                            name="email"
                                                                                            value="<%= license.email %>">
                                                                                        <% if (license.active) { %>
                                                                                            <button type="submit"
                                                                                                class="btn btn-action danger btn-sm"
                                                                                                title="Bloquear Acesso">
                                                                                                <i
                                                                                                    class="fa-solid fa-ban"></i>
                                                                                            </button>
                                                                                            <% } else { %>
                                                                                                <button type="submit"
                                                                                                    class="btn btn-action success btn-sm"
                                                                                                    title="Restaurar Acesso">
                                                                                                    <i
                                                                                                        class="fa-solid fa-check"></i>
                                                                                                </button>
                                                                                                <% } %>
                                                                            </form>
                                                                            <a href="/admin/client/<%= encodeURIComponent(license.email) %>"
                                                                                class="btn btn-action btn-sm"
                                                                                title="Ver Detalhes">
                                                                                <i class="fa-solid fa-eye"></i>
                                                                            </a>
                                                                            <button type="button" class="btn btn-action danger btn-sm btn-delete-client"
                                                                                data-client-email="<%= license.email %>"
                                                                                onclick="if(typeof window.deleteClient==='function'){window.deleteClient('<%= license.email %>');return false;}else{console.error('deleteClient n√£o dispon√≠vel, tipo:',typeof window.deleteClient);alert('Erro: Fun√ß√£o deleteClient n√£o dispon√≠vel. Recarregue a p√°gina.');return false;}"
                                                                                title="Excluir Cliente Permanentemente">
                                                                                <i class="fa-solid fa-trash"></i>
                                                                            </button>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <tr class="table-row-details" id="details-<%= index %>"
                                                                    style="display: none;">
                                                                    <td colspan="6">
                                                                        <div class="row-details-content">
                                                                            <div class="row g-3">
                                                                                <div class="col-md-6">
                                                                                    <div class="detail-item">
                                                                                        <span class="detail-label">
                                                                                            <i
                                                                                                class="fa-solid fa-key me-2"></i>Chave
                                                                                            de Licen√ßa:
                                                                                        </span>
                                                                                        <div class="detail-value">
                                                                                            <span class="license-code">
                                                                                                <%= license.key %>
                                                                                            </span>
                                                                                            <button
                                                                                                class="btn btn-sm btn-action ms-2"
                                                                                                onclick="copyKey('<%= license.key %>')"
                                                                                                title="Copiar">
                                                                                                <i
                                                                                                    class="fa-solid fa-copy"></i>
                                                                                            </button>
                                                                                            <button
                                                                                                class="btn btn-sm btn-action ms-1"
                                                                                                onclick="regenerateKey('<%= license.email %>')"
                                                                                                title="Regenerar">
                                                                                                <i
                                                                                                    class="fa-solid fa-key"></i>
                                                                                            </button>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-6">
                                                                                    <div class="detail-item">
                                                                                        <span class="detail-label">
                                                                                            <i
                                                                                                class="fa-solid fa-box me-2"></i>Produto:
                                                                                        </span>
                                                                                        <span class="detail-value">
                                                                                            <span class="badge bg-info">
                                                                                                <%= productName %>
                                                                                            </span>
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-6">
                                                                                    <div class="detail-item">
                                                                                        <span class="detail-label">
                                                                                            <i
                                                                                                class="fa-solid fa-globe me-2"></i>Dom√≠nio:
                                                                                        </span>
                                                                                        <span class="detail-value">
                                                                                            <% if (license.domain) { %>
                                                                                                <a href="http://<%= license.domain %>"
                                                                                                    target="_blank"
                                                                                                    class="domain-link">
                                                                                                    <i
                                                                                                        class="fa-solid fa-link me-1"></i>
                                                                                                    <%= license.domain
                                                                                                        %>
                                                                                                </a>
                                                                                                <% } else { %>
                                                                                                    <span
                                                                                                        class="text-secondary fst-italic">
                                                                                                        <i
                                                                                                            class="fa-regular fa-clock me-1"></i>Pendente
                                                                                                    </span>
                                                                                                    <% } %>
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-6">
                                                                                    <div class="detail-item">
                                                                                        <span class="detail-label">
                                                                                            <i
                                                                                                class="fa-solid fa-calendar me-2"></i>Data
                                                                                            de Expira√ß√£o:
                                                                                        </span>
                                                                                        <span class="detail-value">
                                                                                            <% if (expiresAt) { %>
                                                                                                <%= expiresAt.toLocaleDateString('pt-BR')
                                                                                                    %>
                                                                                                    <% if (isExpired) {
                                                                                                        %>
                                                                                                        <span
                                                                                                            class="badge bg-danger ms-2">
                                                                                                            <i
                                                                                                                class="fa-solid fa-exclamation-triangle me-1"></i>Expirado
                                                                                                        </span>
                                                                                                        <% } else if
                                                                                                            (isExpiringSoon)
                                                                                                            { %>
                                                                                                            <span
                                                                                                                class="badge bg-warning text-dark ms-2">
                                                                                                                <i
                                                                                                                    class="fa-solid fa-clock me-1"></i>Expira
                                                                                                                em <%=
                                                                                                                    daysLeft
                                                                                                                    %>
                                                                                                                    dia
                                                                                                                    <%= daysLeft
                                                                                                                        !==1
                                                                                                                        ? 's'
                                                                                                                        : ''
                                                                                                                        %>
                                                                                                            </span>
                                                                                                            <% } else {
                                                                                                                %>
                                                                                                                <span
                                                                                                                    class="text-secondary ms-2">
                                                                                                                    (em
                                                                                                                    <%= daysLeft
                                                                                                                        %>
                                                                                                                        dia
                                                                                                                        <%= daysLeft
                                                                                                                            !==1
                                                                                                                            ? 's'
                                                                                                                            : ''
                                                                                                                            %>
                                                                                                                            )
                                                                                                                </span>
                                                                                                                <% } %>
                                                                                                                    <% } else
                                                                                                                        {
                                                                                                                        %>
                                                                                                                        <span
                                                                                                                            class="text-secondary">N√£o
                                                                                                                            definida</span>
                                                                                                                        <% }
                                                                                                                            %>
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-6">
                                                                                    <div class="detail-item">
                                                                                        <span class="detail-label">
                                                                                            <i
                                                                                                class="fa-solid fa-calendar-plus me-2"></i>Data
                                                                                            de Cria√ß√£o:
                                                                                        </span>
                                                                                        <span class="detail-value">
                                                                                            <%= new
                                                                                                Date(license.createdAt).toLocaleDateString('pt-BR')
                                                                                                %>
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-6">
                                                                                    <div class="detail-item">
                                                                                        <span class="detail-label">
                                                                                            <i
                                                                                                class="fa-solid fa-clock-rotate-left me-2"></i>√öltima
                                                                                            Atualiza√ß√£o:
                                                                                        </span>
                                                                                        <span class="detail-value">
                                                                                            <%= license.updatedAt ? new
                                                                                                Date(license.updatedAt).toLocaleDateString('pt-BR')
                                                                                                : 'Nunca' %>
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <% }); %>
                                                                    <% } %>
                                                </tbody>
                                            </table>
                                        </div>

                                        <!-- Pagina√ß√£o -->
                                        <% if (typeof pagination !=='undefined' && pagination.totalPages> 1) { %>
                                            <div class="p-4 border-top border-secondary">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div class="text-secondary" style="font-size: 0.85rem;">
                                                        Mostrando <%= (pagination.page - 1) * pagination.limit + 1 %> -
                                                            <%= Math.min(pagination.page * pagination.limit,
                                                                pagination.totalLicenses) %>
                                                                de <%= pagination.totalLicenses %> licen√ßas
                                                    </div>
                                                    <nav>
                                                        <ul class="pagination pagination-sm mb-0">
                                                            <% if (pagination.hasPrev) { %>
                                                                <li class="page-item">
                                                                    <a class="page-link bg-dark text-white border-secondary"
                                                                        href="/admin?page=<%= pagination.page - 1 %><%= typeof search !== 'undefined' && search ? '&amp;search=' + encodeURIComponent(search) : '' %><%= typeof filterStatus !== 'undefined' && filterStatus !== 'all' ? '&amp;status=' + filterStatus : '' %><%= typeof filterPlan !== 'undefined' && filterPlan !== 'all' ? '&amp;plan=' + filterPlan : '' %><%= typeof filters !== 'undefined' && filters.product && filters.product !== 'all' ? '&amp;product=' + filters.product : '' %>">
                                                                        <i class="fa-solid fa-chevron-left"></i>
                                                                    </a>
                                                                </li>
                                                                <% } else { %>
                                                                    <li class="page-item disabled">
                                                                        <span
                                                                            class="page-link bg-dark text-secondary border-secondary">
                                                                            <i class="fa-solid fa-chevron-left"></i>
                                                                        </span>
                                                                    </li>
                                                                    <% } %>

                                                                        <% for (let i=Math.max(1, pagination.page - 2);
                                                                            i <=Math.min(pagination.totalPages,
                                                                            pagination.page + 2); i++) { %>
                                                                            <li
                                                                                class="page-item <%= i === pagination.page ? 'active' : '' %>">
                                                                                <a class="page-link bg-dark text-white border-secondary <%= i === pagination.page ? 'bg-primary' : '' %>"
                                                                                    href="/admin?page=<%= i %><%= typeof search !== 'undefined' && search ? '&amp;search=' + encodeURIComponent(search) : '' %><%= typeof filterStatus !== 'undefined' && filterStatus !== 'all' ? '&amp;status=' + filterStatus : '' %><%= typeof filterPlan !== 'undefined' && filterPlan !== 'all' ? '&amp;plan=' + filterPlan : '' %><%= typeof filters !== 'undefined' && filters.product && filters.product !== 'all' ? '&amp;product=' + filters.product : '' %>">
                                                                                    <%= i %>
                                                                                </a>
                                                                            </li>
                                                                            <% } %>

                                                                                <% if (pagination.hasNext) { %>
                                                                                    <li class="page-item">
                                                                                        <a class="page-link bg-dark text-white border-secondary"
                                                                                            href="/admin?page=<%= pagination.page + 1 %><%= typeof search !== 'undefined' && search ? '&amp;search=' + encodeURIComponent(search) : '' %><%= typeof filterStatus !== 'undefined' && filterStatus !== 'all' ? '&amp;status=' + filterStatus : '' %><%= typeof filterPlan !== 'undefined' && filterPlan !== 'all' ? '&amp;plan=' + filterPlan : '' %><%= typeof filters !== 'undefined' && filters.product && filters.product !== 'all' ? '&amp;product=' + filters.product : '' %>">
                                                                                            <i
                                                                                                class="fa-solid fa-chevron-right"></i>
                                                                                        </a>
                                                                                    </li>
                                                                                    <% } else { %>
                                                                                        <li class="page-item disabled">
                                                                                            <span
                                                                                                class="page-link bg-dark text-secondary border-secondary">
                                                                                                <i
                                                                                                    class="fa-solid fa-chevron-right"></i>
                                                                                            </span>
                                                                                        </li>
                                                                                        <% } %>
                                                        </ul>
                                                    </nav>
                                                </div>
                                            </div>
                                            <% } %>
                                    </div>

                                    <footer class="mt-5 text-center text-secondary"
                                        style="font-size: 0.8rem; padding: 2rem;">
                                        <p>&copy; 2025 Plugin Cripto Woocommerce. Todos os direitos reservados.</p>
                                    </footer>
                </div>
            </div>
    </div>
    </div>

    <!-- Modal Novo/Editar Produto -->
    <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content bg-dark border-secondary">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="productModalLabel">
                        <i class="fa-solid fa-box me-2"></i>
                        <span id="productModalTitle">Novo Produto</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="productForm" onsubmit="saveProduct(event)">
                        <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <% } %>
                        <input type="hidden" name="productId" id="productId">
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label text-secondary small mb-2">
                                    Nome do Produto <span class="text-danger">*</span>
                                </label>
                                <input type="text" name="name" id="productName" class="form-control" required
                                    placeholder="Ex: Plugin Binance Pix / USDT">
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label text-secondary small mb-2">
                                    Slug (identificador √∫nico) <span class="text-danger">*</span>
                                </label>
                                <input type="text" name="slug" id="productSlug" class="form-control" required
                                    placeholder="Ex: binance-pix" pattern="[a-z0-9-]+" 
                                    title="Apenas letras min√∫sculas, n√∫meros e h√≠fens">
                                <small class="text-secondary">Usado como identificador √∫nico. N√£o pode ser alterado ap√≥s cria√ß√£o.</small>
                            </div>
                            
                            <div class="col-md-12">
                                <label class="form-label text-secondary small mb-2">
                                    Descri√ß√£o
                                </label>
                                <textarea name="description" id="productDescription" class="form-control" rows="3"
                                    placeholder="Descri√ß√£o do produto..."></textarea>
                            </div>
                            
                            <div class="col-md-3">
                                <label class="form-label text-secondary small mb-2">
                                    Dias de Trial
                                </label>
                                <input type="number" name="trialDays" id="productTrialDays" class="form-control" 
                                    value="7" min="0" max="365">
                            </div>
                            
                            <div class="col-md-3">
                                <label class="form-label text-secondary small mb-2">
                                    Pre√ßo Mensal (R$)
                                </label>
                                <input type="number" name="priceMonthly" id="productPriceMonthly" class="form-control" 
                                    step="0.01" min="0" value="97.00">
                            </div>
                            
                            <div class="col-md-3">
                                <label class="form-label text-secondary small mb-2">
                                    Pre√ßo Anual (R$)
                                </label>
                                <input type="number" name="priceYearly" id="productPriceYearly" class="form-control" 
                                    step="0.01" min="0" value="997.00">
                            </div>
                            
                            <div class="col-md-3">
                                <label class="form-label text-secondary small mb-2">
                                    Ordem de Exibi√ß√£o
                                </label>
                                <input type="number" name="order" id="productOrder" class="form-control" 
                                    value="0" min="0">
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label text-secondary small mb-2">
                                    Texto Promocional
                                </label>
                                <input type="text" name="promoText" id="productPromoText" class="form-control" 
                                    placeholder="Ex: Oferta de Lan√ßamento">
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label text-secondary small mb-2">
                                    √çcone (URL ou nome)
                                </label>
                                <input type="text" name="icon" id="productIcon" class="form-control" 
                                    placeholder="Ex: fa-bitcoin ou URL da imagem">
                            </div>
                            
                            <div class="col-md-12">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" name="active" id="productActive" checked>
                                    <label class="form-check-label text-secondary" for="productActive">
                                        Produto Ativo
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-footer border-secondary mt-4">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-accent">
                                <i class="fa-solid fa-save me-2"></i> Salvar Produto
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Novo Cliente - MOVER PARA ANTES DOS SCRIPTS -->
    <div class="modal fade" id="newClientModal" tabindex="-1" aria-labelledby="newClientModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: var(--bg-card); border: 1px solid var(--border-light);">
                <div class="modal-header" style="border-bottom: 1px solid var(--border-light);">
                    <h5 class="modal-title" id="newClientModalLabel" style="color: var(--text-primary);">
                        <i class="fa-solid fa-user-plus me-2" style="color: var(--primary);"></i>
                        Novo Cliente
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"
                        style="filter: invert(1);"></button>
                </div>
                <form id="newClientForm">
                    <% if (typeof csrfToken !=='undefined' && csrfToken) { %>
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <% } %>
                            <div class="modal-body" style="padding: 2rem;">
                                <div class="mb-3">
                                    <label for="clientEmail" class="form-label"
                                        style="color: var(--text-secondary); font-weight: 500;">
                                        Email do Cliente <span style="color: var(--danger);">*</span>
                                    </label>
                                    <input type="email" class="form-control" id="clientEmail" name="email"
                                        placeholder="cliente@exemplo.com" required
                                        style="background: #1e293b; color: #f1f5f9; border: 1px solid var(--border-light);">
                                    <small class="text-secondary"
                                        style="font-size: 0.75rem; margin-top: 0.25rem; display: block;">
                                        O email ser√° usado para login e recebimento da chave de licen√ßa
                                    </small>
                                </div>

                                <!-- Campo hidden para sempre enviar "trial" -->
                                <input type="hidden" name="plan" value="trial">

                                <div class="alert alert-warning"
                                    style="background: rgba(251, 191, 36, 0.15); border-color: rgba(251, 191, 36, 0.4); color: var(--warning); padding: 0.75rem 1rem; font-size: 0.875rem; margin-bottom: 1rem;">
                                    <i class="fa-solid fa-info-circle me-2"></i>
                                    <strong>Plano Trial:</strong> O cliente ser√° criado automaticamente com plano Trial
                                    (7 dias), igual ao sistema de cria√ß√£o de teste.
                                </div>

                                <div class="mb-3">
                                    <label for="clientPassword" class="form-label"
                                        style="color: var(--text-secondary); font-weight: 500;">
                                        Senha <span style="color: var(--danger);">*</span>
                                    </label>
                                    <input type="password" class="form-control" id="clientPassword" name="password"
                                        placeholder="Digite a senha do cliente" required minlength="6"
                                        style="background: #1e293b; color: #f1f5f9; border: 1px solid var(--border-light);">
                                    <small class="text-secondary"
                                        style="font-size: 0.75rem; margin-top: 0.25rem; display: block;">
                                        M√≠nimo de 6 caracteres. O cliente usar√° esta senha para fazer login.
                                    </small>
                                </div>

                                <div class="mb-3">
                                    <label for="clientDomain" class="form-label"
                                        style="color: var(--text-secondary); font-weight: 500;">
                                        Dom√≠nio (Opcional)
                                    </label>
                                    <input type="text" class="form-control" id="clientDomain" name="domain"
                                        placeholder="exemplo.com.br"
                                        style="background: #1e293b; color: #f1f5f9; border: 1px solid var(--border-light);">
                                    <small class="text-secondary"
                                        style="font-size: 0.75rem; margin-top: 0.25rem; display: block;">
                                        Dom√≠nio onde a licen√ßa ser√° usada (pode ser definido depois)
                                    </small>
                                </div>

                                <div class="mb-3">
                                    <label for="clientNotes" class="form-label"
                                        style="color: var(--text-secondary); font-weight: 500;">
                                        Notas (Opcional)
                                    </label>
                                    <textarea class="form-control" id="clientNotes" name="notes" rows="3"
                                        placeholder="Adicione notas sobre este cliente..."
                                        style="background: #1e293b; color: #f1f5f9; border: 1px solid var(--border-light);"></textarea>
                                </div>

                            </div>
                            <div class="modal-footer" style="border-top: 1px solid var(--border-light);">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                                    style="background: var(--bg-tertiary); border: 1px solid var(--border-light); color: var(--text-primary);">
                                    Cancelar
                                </button>
                                <button type="submit" class="btn btn-primary"
                                    style="background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%); border: none; color: #fff;">
                                    <i class="fa-solid fa-check me-2"></i>
                                    Criar Cliente
                                </button>
                            </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Script de diagn√≥stico externo (evita CSP inline) -->
    <script src="/diagnostic-fix.js"></script>

    <script>
        // ============================================
        // FUN√á√ïES GLOBAIS - DEFINIR PRIMEIRO
        // ============================================
        
        // IMPORTANTE: Definir a fun√ß√£o ANTES de qualquer outro c√≥digo
        // Fun√ß√£o para deletar cliente completamente (DEFINIR PRIMEIRO - ANTES DE QUALQUER USO)
        // Garantir que est√° dispon√≠vel em m√∫ltiplos escopos
        (function() {
            'use strict';
            
            // Definir fun√ß√£o imediatamente
            window.deleteClient = function deleteClient(email) {
            // Confirma√ß√£o dupla para evitar exclus√µes acidentais
            var confirmFirst = confirm(
                '‚ö†Ô∏è ATEN√á√ÉO: Voc√™ est√° prestes a EXCLUIR PERMANENTEMENTE o cliente:\n\n' +
                email + '\n\n' +
                'Esta a√ß√£o ir√°:\n' +
                '‚Ä¢ Remover a licen√ßa\n' +
                '‚Ä¢ Deletar o usu√°rio\n' +
                '‚Ä¢ Apagar todos os logs\n' +
                '‚Ä¢ Remover todas as notifica√ß√µes\n\n' +
                'Esta a√ß√£o N√ÉO PODE SER DESFEITA!\n\n' +
                'Deseja continuar?'
            );

            if (!confirmFirst) return;

            // Segunda confirma√ß√£o
            var confirmSecond = confirm(
                'Confirme novamente: Excluir ' + email + ' PERMANENTEMENTE?'
            );

            if (!confirmSecond) return;

            // Obter token CSRF
            var csrfMeta = document.querySelector('meta[name="csrf-token"]');
            var csrfToken = csrfMeta ? csrfMeta.getAttribute('content') : '';

            console.log('üóëÔ∏è Deletando cliente:', email);
            console.log('üîë CSRF Token:', csrfToken ? 'Presente' : 'Ausente');

            fetch('/admin/delete-client', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'CSRF-Token': csrfToken,
                    'X-CSRF-Token': csrfToken
                },
                body: JSON.stringify({
                    email: email,
                    _csrf: csrfToken
                }),
                credentials: 'same-origin'
            })
                .then(function (response) {
                    console.log('üì° Resposta do servidor:', response.status, response.statusText);
                    if (!response.ok) {
                        return response.json().then(function(err) {
                            throw new Error(err.message || 'Erro ao deletar cliente');
                        });
                    }
                    return response.json();
                })
                .then(function (result) {
                    console.log('‚úÖ Resultado:', result);
                    if (result.success) {
                        alert('‚úÖ Cliente exclu√≠do com sucesso!');
                        window.location.reload();
                    } else {
                        alert('‚ùå Erro: ' + (result.message || 'Falha ao excluir cliente'));
                    }
                })
                .catch(function (error) {
                    console.error('‚ùå Erro ao deletar cliente:', error);
                    alert('‚ùå Erro ao excluir cliente: ' + error.message + '\n\nVerifique o console para mais detalhes.');
                });
            };
            
            // Tamb√©m criar refer√™ncia local para compatibilidade
            var deleteClient = window.deleteClient;
            
            // Tamb√©m atribuir diretamente (backup)
            if (typeof globalThis !== 'undefined') {
                globalThis.deleteClient = window.deleteClient;
            }
            
            console.log('‚úÖ Fun√ß√£o deleteClient definida IMEDIATAMENTE no escopo global');
            console.log('‚úÖ window.deleteClient:', typeof window.deleteClient);
            console.log('‚úÖ Teste r√°pido:', typeof window.deleteClient === 'function' ? 'OK' : 'ERRO');
            
            // Teste imediato
            if (typeof window.deleteClient !== 'function') {
                console.error('‚ùå ERRO CR√çTICO: deleteClient n√£o foi definida corretamente!');
            }
        })();
        
        // Verifica√ß√£o adicional ap√≥s defini√ß√£o
        console.log('‚úÖ Verifica√ß√£o p√≥s-defini√ß√£o - window.deleteClient:', typeof window.deleteClient);
        
        // Verifica√ß√£o adicional - garantir que est√° no escopo global
        if (typeof window.deleteClient === 'function') {
            console.log('‚úÖ deleteClient confirmada no escopo global');
        } else {
            console.error('‚ùå ERRO: deleteClient N√ÉO est√° no escopo global!');
        }
        
        // Event delegation para bot√µes de deletar (funciona mesmo com stopPropagation)
        // Usar event delegation no document para capturar todos os cliques
        function setupDeleteButtons() {
            console.log('üîç Configurando event delegation para bot√µes de deletar...');
            
            // Remover listeners anteriores se existirem
            if (window._deleteButtonHandler) {
                document.removeEventListener('click', window._deleteButtonHandler);
            }
            
            // Criar handler usando event delegation
            window._deleteButtonHandler = function(e) {
                // Verificar se o clique foi em um bot√£o de deletar ou em seus filhos
                const deleteButton = e.target.closest('.btn-delete-client');
                
                if (deleteButton) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    
                    const email = deleteButton.getAttribute('data-client-email');
                    console.log('üñ±Ô∏è Bot√£o deletar clicado!');
                    console.log('üìß Email:', email);
                    console.log('üîç Fun√ß√£o deleteClient dispon√≠vel?', typeof window.deleteClient === 'function');
                    
                    if (!email) {
                        console.error('‚ùå Erro: email n√£o encontrado no atributo data-client-email');
                        alert('‚ùå Erro: Email do cliente n√£o encontrado. Recarregue a p√°gina.');
                        return false;
                    }
                    
                    if (typeof window.deleteClient !== 'function') {
                        console.error('‚ùå Erro: fun√ß√£o deleteClient n√£o est√° dispon√≠vel');
                        console.error('‚ùå Tipo de window.deleteClient:', typeof window.deleteClient);
                        alert('‚ùå Erro: Fun√ß√£o de deletar n√£o est√° dispon√≠vel. Recarregue a p√°gina.');
                        return false;
                    }
                    
                    console.log('‚úÖ Chamando deleteClient com email:', email);
                    try {
                        window.deleteClient(email);
                    } catch (error) {
                        console.error('‚ùå Erro ao executar deleteClient:', error);
                        alert('‚ùå Erro ao deletar cliente: ' + error.message);
                    }
                    
                    return false;
                }
            };
            
            // Adicionar listener no document (captura fase)
            document.addEventListener('click', window._deleteButtonHandler, true);
            
            // Verificar quantos bot√µes existem
            const deleteButtons = document.querySelectorAll('.btn-delete-client');
            console.log('üìä Bot√µes de deletar encontrados:', deleteButtons.length);
            
            if (deleteButtons.length === 0) {
                console.warn('‚ö†Ô∏è Nenhum bot√£o de deletar encontrado. Os bot√µes podem ser criados dinamicamente.');
            } else {
                deleteButtons.forEach(function(btn, index) {
                    const email = btn.getAttribute('data-client-email');
                    console.log(`  Bot√£o ${index + 1}: email = ${email}`);
                });
            }
            
            console.log('‚úÖ Event delegation configurado para bot√µes de deletar');
        }
        
        // Configurar quando DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setupDeleteButtons);
        } else {
            // DOM j√° carregado
            setupDeleteButtons();
        }
        
        // Tamb√©m configurar ap√≥s window.load (para garantir)
        window.addEventListener('load', function() {
            console.log('üîÑ Window carregada, reconfigurando bot√µes de deletar...');
            setTimeout(setupDeleteButtons, 100);
        });

        // FUN√á√ïES GLOBAIS DO MODAL - AGUARDAR BOOTSTRAP CARREGAR
        // Usar fun√ß√£o que aguarda o Bootstrap estar dispon√≠vel
        function initModalFunctions() {
            // Verificar se Bootstrap est√° dispon√≠vel
            if (typeof bootstrap === 'undefined' || typeof bootstrap.Modal === 'undefined') {
                console.warn('‚ö†Ô∏è Bootstrap ainda n√£o est√° carregado, aguardando...');
                setTimeout(initModalFunctions, 100);
                return;
            }

            console.log('‚úÖ Bootstrap carregado, definindo fun√ß√µes do modal');

            // FUN√á√ÉO PARA ABRIR MODAL - VERS√ÉO SIMPLIFICADA
            window.openNewClientModal = function () {
                try {
                    console.log('üîç Tentando abrir modal...');
                    const modalElement = document.getElementById('newClientModal');
                    if (!modalElement) {
                        console.error('‚ùå Modal newClientModal n√£o encontrado!');
                        alert('Erro: Modal n√£o encontrado. Recarregue a p√°gina.');
                        return;
                    }

                    // Verificar se Bootstrap est√° dispon√≠vel
                    if (typeof bootstrap === 'undefined' || typeof bootstrap.Modal === 'undefined') {
                        console.error('‚ùå Bootstrap n√£o est√° carregado!');
                        alert('Erro: Bootstrap n√£o est√° dispon√≠vel. Recarregue a p√°gina.');
                        return;
                    }

                    console.log('‚úÖ Modal encontrado, Bootstrap dispon√≠vel');

                    // M√©todo 1: Tentar usar Bootstrap Modal API
                    try {
                        let bsModal = bootstrap.Modal.getInstance(modalElement);
                        if (!bsModal) {
                            console.log('üì¶ Criando nova inst√¢ncia do modal Bootstrap...');
                            bsModal = new bootstrap.Modal(modalElement, {
                                backdrop: true,
                                keyboard: true,
                                focus: true
                            });
                        }

                        if (bsModal && typeof bsModal.show === 'function') {
                            bsModal.show();
                            // Ocultar √°rea de resultado do diagn√≥stico ao abrir o modal
                            const diagnosticResult = document.getElementById('diagnosticResult');
                            if (diagnosticResult) {
                                diagnosticResult.style.display = 'none';
                            }
                            // Garantir que o listener do bot√£o de diagn√≥stico est√° anexado
                            setTimeout(() => {
                                setupDiagnosticButton();
                            }, 100);
                            console.log('‚úÖ Modal aberto com Bootstrap API!');
                            return;
                        }
                    } catch (bsError) {
                        console.warn('‚ö†Ô∏è Erro ao usar Bootstrap API:', bsError);
                    }

                    // M√©todo 2: Fallback - Manipula√ß√£o direta do DOM
                    console.log('üì¶ Usando fallback manual para abrir modal...');
                    modalElement.classList.add('show');
                    modalElement.style.display = 'block';
                    modalElement.setAttribute('aria-hidden', 'false');
                    modalElement.removeAttribute('aria-hidden');
                    document.body.classList.add('modal-open');
                    document.body.style.overflow = 'hidden';

                    // Criar backdrop manualmente
                    let backdrop = document.getElementById('modalBackdrop');
                    if (!backdrop) {
                        backdrop = document.createElement('div');
                        backdrop.className = 'modal-backdrop fade show';
                        backdrop.id = 'modalBackdrop';
                        document.body.appendChild(backdrop);
                    }

                    // Adicionar evento para fechar ao clicar no backdrop
                    backdrop.addEventListener('click', function () {
                        window.closeNewClientModal();
                    });

                    // Ocultar √°rea de resultado do diagn√≥stico ao abrir o modal
                    const diagnosticResult = document.getElementById('diagnosticResult');
                    if (diagnosticResult) {
                        diagnosticResult.style.display = 'none';
                    }
                    // Garantir que o listener do bot√£o de diagn√≥stico est√° anexado
                    setTimeout(() => {
                        setupDiagnosticButton();
                    }, 100);

                    console.log('‚úÖ Modal aberto manualmente!');
                } catch (error) {
                    console.error('‚ùå Erro ao abrir modal:', error);
                    console.error('Stack trace:', error.stack);
                    alert('Erro ao abrir modal: ' + error.message);
                }
            };

            // FUN√á√ÉO PARA FECHAR MODAL
            window.closeNewClientModal = function () {
                try {
                    const modal = document.getElementById('newClientModal');
                    if (modal && typeof bootstrap !== 'undefined') {
                        const bsModal = bootstrap.Modal.getInstance(modal);
                        if (bsModal) {
                            bsModal.hide();
                        } else {
                            // Fallback: remover manualmente
                            modal.classList.remove('show');
                            modal.style.display = 'none';
                            document.body.classList.remove('modal-open');
                            const backdrop = document.getElementById('modalBackdrop');
                            if (backdrop) backdrop.remove();
                        }
                    }
                } catch (error) {
                    console.error('Erro ao fechar modal:', error);
                }
            };

        // ============================================
        // GERENCIAMENTO DE PRODUTOS
        // ============================================
        
        window.openNewProductModal = function() {
            try {
                const modal = document.getElementById('productModal');
                if (!modal) {
                    alert('Modal de produto n√£o encontrado!');
                    return;
                }
                
                // Resetar formul√°rio
                document.getElementById('productForm').reset();
                document.getElementById('productId').value = '';
                document.getElementById('productModalTitle').textContent = 'Novo Produto';
                document.getElementById('productSlug').disabled = false;
                document.getElementById('productActive').checked = true;
                
                // Abrir modal
                if (typeof bootstrap !== 'undefined') {
                    const bsModal = new bootstrap.Modal(modal);
                    bsModal.show();
                } else {
                    modal.style.display = 'block';
                    modal.classList.add('show');
                }
            } catch (error) {
                console.error('Erro ao abrir modal de produto:', error);
                alert('Erro: ' + error.message);
            }
        };

        window.editProduct = async function(productId) {
            try {
                // Buscar dados do produto
                const response = await fetch(`/admin/products/${productId}`);
                if (!response.ok) {
                    throw new Error('Erro ao buscar produto');
                }
                
                const product = await response.json();
                
                // Preencher formul√°rio
                document.getElementById('productId').value = product._id;
                document.getElementById('productName').value = product.name || '';
                document.getElementById('productSlug').value = product.slug || '';
                document.getElementById('productSlug').disabled = true; // N√£o pode alterar slug
                document.getElementById('productDescription').value = product.description || '';
                document.getElementById('productTrialDays').value = product.trialDays || 7;
                document.getElementById('productPriceMonthly').value = product.priceMonthly || 0;
                document.getElementById('productPriceYearly').value = product.priceYearly || 0;
                document.getElementById('productOrder').value = product.order || 0;
                document.getElementById('productPromoText').value = product.promoText || '';
                document.getElementById('productIcon').value = product.icon || '';
                document.getElementById('productActive').checked = product.active !== false;
                
                document.getElementById('productModalTitle').textContent = 'Editar Produto';
                
                // Abrir modal
                const modal = document.getElementById('productModal');
                if (typeof bootstrap !== 'undefined') {
                    const bsModal = new bootstrap.Modal(modal);
                    bsModal.show();
                } else {
                    modal.style.display = 'block';
                    modal.classList.add('show');
                }
            } catch (error) {
                console.error('Erro ao editar produto:', error);
                alert('Erro: ' + error.message);
            }
        };

        window.saveProduct = async function(event) {
            event.preventDefault();
            
            const form = document.getElementById('productForm');
            const formData = new FormData(form);
            const productId = formData.get('productId');
            const isEdit = !!productId;
            
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin me-2"></i> Salvando...';
            
            try {
                const csrfToken = formData.get('_csrf');
                const data = {
                    name: formData.get('name'),
                    slug: formData.get('slug'),
                    description: formData.get('description') || '',
                    trialDays: parseInt(formData.get('trialDays')) || 7,
                    priceMonthly: parseFloat(formData.get('priceMonthly')) || 0,
                    priceYearly: parseFloat(formData.get('priceYearly')) || 0,
                    order: parseInt(formData.get('order')) || 0,
                    promoText: formData.get('promoText') || '',
                    icon: formData.get('icon') || '',
                    active: formData.get('active') === 'on',
                    _csrf: csrfToken
                };
                
                const url = isEdit ? `/admin/products/${productId}` : '/admin/products';
                const method = isEdit ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'CSRF-Token': csrfToken,
                        'X-CSRF-Token': csrfToken
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    submitBtn.innerHTML = '<i class="fa-solid fa-check me-2"></i> Salvo!';
                    submitBtn.classList.remove('btn-accent');
                    submitBtn.classList.add('btn-success');
                    
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    throw new Error(result.message || 'Erro ao salvar produto');
                }
            } catch (error) {
                console.error('Erro ao salvar produto:', error);
                alert('Erro: ' + error.message);
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        };

        window.deleteProduct = async function(productId, productName) {
            if (!confirm(`Tem certeza que deseja deletar o produto "${productName}"?\n\nEsta a√ß√£o n√£o pode ser desfeita!`)) {
                return;
            }
            
            try {
                const csrfMeta = document.querySelector('meta[name="csrf-token"]');
                const csrfToken = csrfMeta ? csrfMeta.getAttribute('content') : '';
                
                const response = await fetch(`/admin/products/${productId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'CSRF-Token': csrfToken,
                        'X-CSRF-Token': csrfToken
                    },
                    body: JSON.stringify({ _csrf: csrfToken })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Produto deletado com sucesso!');
                    window.location.reload();
                } else {
                    throw new Error(result.message || 'Erro ao deletar produto');
                }
            } catch (error) {
                console.error('Erro ao deletar produto:', error);
                alert('Erro: ' + error.message);
            }
        };
        } // FIM DA FUN√á√ÉO initModalFunctions

        // FUN√á√ÉO PARA SUBMETER FORMUL√ÅRIO
        let isSubmitting = false; // Flag global para prevenir m√∫ltiplos envios

        window.submitNewClient = async function (event) {
            event.preventDefault();

            if (isSubmitting) return;

            console.log('üìù Iniciando submiss√£o do formul√°rio...');

            const form = event.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;

            // Bloquear submiss√£o visualmente e logicamente
            isSubmitting = true;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin me-2"></i> Criando...';

            try {
                // Coletar dados do formul√°rio
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);

                // Obter token CSRF
                let csrfToken = data._csrf || '';
                if (!csrfToken) {
                    const metaCsrf = document.querySelector('meta[name="csrf-token"]');
                    if (metaCsrf) csrfToken = metaCsrf.getAttribute('content');
                }

                // Enviar usando JSON
                const requestBody = {
                    email: data.email,
                    plan: 'trial', // Sempre trial
                    password: data.password,
                    domain: data.domain || null,
                    notes: data.notes || null,
                    _csrf: csrfToken
                };

                console.log('üåê Enviando requisi√ß√£o para /admin/create-client (JSON)...');

                const headers = {
                    'Content-Type': 'application/json'
                };

                if (csrfToken) {
                    headers['CSRF-Token'] = csrfToken;
                    headers['X-CSRF-Token'] = csrfToken;
                }

                const response = await fetch('/admin/create-client', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(requestBody),
                    credentials: 'same-origin'
                });

                console.log('üì• Resposta recebida:', response.status);

                if (!response.ok) {
                    // Tentar ler erro como JSON, fallback para texto
                    let errorMessage = 'Erro do servidor (${response.status})';
                    try {
                        const errorData = await response.json();
                        if (errorData.message) errorMessage = errorData.message;
                    } catch (e) {
                        const text = await response.text();
                        if (text) errorMessage = text.substring(0, 100);
                    }
                    throw new Error(errorMessage);
                }

                const result = await response.json();
                console.log('‚úÖ Resultado:', result);

                if (result.success) {
                    // SUCESSO - Feedback visual suave
                    console.log('‚úÖ Cliente criado com sucesso!');

                    submitBtn.innerHTML = '<i class="fa-solid fa-check me-2"></i> Sucesso!';
                    submitBtn.classList.remove('btn-primary');
                    submitBtn.classList.add('btn-success');

                    // Fechar modal e recarregar
                    setTimeout(() => {
                        window.closeNewClientModal();
                        window.location.reload();
                    }, 1000);
                } else {
                    // ERRO DO SERVIDOR
                    throw new Error(result.message || 'Erro ao criar cliente');
                }
            } catch (error) {
                // ERRO - Mostrar alert e liberar bot√£o
                console.error('‚ùå Erro:', error);
                alert('Erro: ' + error.message);

                isSubmitting = false;
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        };

        // Bot√£o de diagn√≥stico: faz um POST de teste para /admin/create-client com dados falsos
        window.runCreateClientDiagnostic = async function () {
            console.log('üß™ === INICIANDO DIAGN√ìSTICO ===');
            try {
                const modal = document.getElementById('newClientModal');
                if (!modal) {
                    console.error('‚ùå Modal n√£o encontrado!');
                    alert('Erro: Modal n√£o encontrado. Recarregue a p√°gina.');
                    return;
                }

                const csrfInput = modal.querySelector('input[name="_csrf"]');
                const csrfToken = csrfInput ? csrfInput.value : '';
                console.log('üîë CSRF Token:', csrfToken ? 'Presente' : 'Ausente');

                const testEmail = 'diagnostic+${Date.now()}@example.com';
                console.log('üìß Email de teste:', testEmail);

                const formData = new FormData();
                formData.append('email', testEmail);
                formData.append('plan', 'trial');
                formData.append('password', 'senha123456');
                formData.append('domain', 'diagnostic.test');
                formData.append('notes', 'Cliente de diagn√≥stico autom√°tico');
                if (csrfToken) formData.append('_csrf', csrfToken);

                // Mostrar resultado no modal
                console.log('üì§ Mostrando resultado no modal...');
                updateDiagnosticResult(
                    'Executando Diagn√≥stico',
                    'Enviando requisi√ß√£o para o servidor...',
                    'Aguarde enquanto testamos a cria√ß√£o de cliente.',
                    'info'
                );
                updateDiagnosticStatus('Executando diagn√≥stico', 'Enviando requisi√ß√£o...', 'info');
                console.log('‚úÖ √Årea de resultado exibida');

                const response = await fetch('/admin/create-client', {
                    method: 'POST',
                    body: formData,
                    credentials: 'same-origin'
                });

                if (!response.ok) {
                    const text = await response.text().catch(() => '(sem corpo)');
                    const errorMsg = text.length > 200 ? text.substring(0, 200) + '...' : text;
                    updateDiagnosticResult(
                        '‚ùå Diagn√≥stico Falhou',
                        'O servidor retornou um erro HTTP ${response.status}.',
                        'Resposta: ${errorMsg}',
                        'error'
                    );
                    updateDiagnosticStatus('Falhou', 'HTTP ${response.status}: ${errorMsg}', 'error');
                    return;
                }

                const result = await response.json().catch(() => null);

                if (result && result.success) {
                    const email = result.license?.email || testEmail;
                    const key = result.license?.key || 'n√£o retornada';
                    const keyDisplay = key.length > 30 ? key.substring(0, 30) + '...' : key;
                    updateDiagnosticResult(
                        '‚úÖ Diagn√≥stico OK',
                        'Cliente teste criado com sucesso!',
                        '<strong>Email:</strong> ${email}<br><strong>Chave de Licen√ßa:</strong> <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">${keyDisplay}</code>',
                        'success'
                    );
                    updateDiagnosticStatus('Sucesso', 'Cliente: ${email} | Chave: ${keyDisplay}', 'success');
                } else {
                    const msg = result?.message || 'resposta inesperada';
                    updateDiagnosticResult(
                        '‚ùå Diagn√≥stico Falhou',
                        'N√£o foi poss√≠vel criar o cliente teste.',
                        'Erro: ${msg}',
                        'error'
                    );
                    updateDiagnosticStatus('Falhou', msg, 'error');
                }
            } catch (err) {
                updateDiagnosticResult(
                    '‚ùå Erro no Diagn√≥stico',
                    'Ocorreu um erro ao executar o diagn√≥stico.',
                    'Erro: ${err.message}',
                    'error'
                );
                updateDiagnosticStatus('Erro', err.message, 'error');
            }
        }

            // Dados dos gr√°ficos (simplificado para evitar erro de sintaxe)
            <% const safeRevenueData = (stats && stats.revenueByMonth) ? stats.revenueByMonth : []; %>
        <% const safeClientsData = (stats && stats.newClientsByMonth) ? stats.newClientsByMonth : []; %>
        <% const safePlanData = (stats && stats.planDistribution) ? stats.planDistribution : { trial: 0, monthly: 0, yearly: 0 }; %>
        const revenueData = <%= JSON.stringify(safeRevenueData) %>;
        const clientsData = <%= JSON.stringify(safeClientsData) %>;
        const planData = <%= JSON.stringify(safePlanData) %>;

        // Configura√ß√£o de cores
        const chartColors = {
            primary: '#6366f1',
            success: '#3fb950',
            danger: '#f85149',
            info: '#58a6ff',
            warning: '#d29922',
            secondary: '#8b949e'
        };

        // Gr√°fico de Receita
        if (revenueData.length > 0) {
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: revenueData.map(d => d.month),
                        datasets: [{
                            label: 'Receita Mensal (R$)',
                            data: revenueData.map(d => d.revenue),
                            borderColor: chartColors.primary,
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: true,
                                labels: {
                                    color: '#c9d1d9'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: '#c9d1d9',
                                    callback: function (value) {
                                        return 'R$ ' + value.toFixed(2).replace('.', ',');
                                    }
                                },
                                grid: {
                                    color: '#30363d'
                                }
                            },
                            x: {
                                ticks: {
                                    color: '#c9d1d9'
                                },
                                grid: {
                                    color: '#30363d'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Gr√°fico de Distribui√ß√£o de Planos
        const planCtx = document.getElementById('planChart');
        if (planCtx) {
            new Chart(planCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Trial', 'Mensal', 'Anual'],
                    datasets: [{
                        data: [planData.trial || 0, planData.monthly || 0, planData.yearly || 0],
                        backgroundColor: [
                            chartColors.warning,
                            chartColors.info,
                            chartColors.success
                        ],
                        borderColor: '#161b22',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#c9d1d9',
                                padding: 15
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico de Novos Clientes
        if (clientsData.length > 0) {
            const clientsCtx = document.getElementById('clientsChart');
            if (clientsCtx) {
                new Chart(clientsCtx, {
                    type: 'bar',
                    data: {
                        labels: clientsData.map(d => d.month),
                        datasets: [{
                            label: 'Novos Clientes',
                            data: clientsData.map(d => d.count),
                            backgroundColor: chartColors.info,
                            borderColor: chartColors.info,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: true,
                                labels: {
                                    color: '#c9d1d9'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: '#c9d1d9',
                                    stepSize: 1
                                },
                                grid: {
                                    color: '#30363d'
                                }
                            },
                            x: {
                                ticks: {
                                    color: '#c9d1d9'
                                },
                                grid: {
                                    color: '#30363d'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Sistema de Toast Notifications
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'toast-notification toast-${type}';
            toast.style.cssText = '
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--danger)' : type === 'warning' ? 'var(--warning)' : 'var(--info)'};
                color: #fff;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: var(--shadow-lg);
                z-index: 10000;
                display: flex;
                align-items: center;
                gap: 0.75rem;
                min-width: 300px;
                animation: slideInRight 0.3s ease;
            ';

            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-triangle-exclamation',
                info: 'fa-info-circle'
            };

            toast.innerHTML = '
                <i class="fa-solid ${icons[type]}"></i>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" style="background: transparent; border: none; color: #fff; margin-left: auto; cursor: pointer; padding: 0.25rem;">
                    <i class="fa-solid fa-times"></i>
                </button>
            ';

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // Adicionar anima√ß√µes CSS
        const style = document.createElement('style');
        style.textContent = '
            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        ';
        document.head.appendChild(style);

        // Mensagens de sucesso/erro (usando toasts)
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('success')) {
            showToast('Altera√ß√µes salvas com sucesso!', 'success');
        }
        if (urlParams.get('error')) {
            showToast('Erro: ' + urlParams.get('error'), 'error');
        }

        // Toggle Sidebar (global)
        window.toggleSidebar = function () {
            const sidebar = document.getElementById('adminSidebar');
            const icon = document.getElementById('sidebarToggleIcon');
            if (sidebar && icon) {
                sidebar.classList.toggle('collapsed');
                icon.classList.toggle('fa-chevron-left');
                icon.classList.toggle('fa-chevron-right');
                localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
            }
        };

        // Restaurar estado da sidebar
        document.addEventListener('DOMContentLoaded', function () {
            if (localStorage.getItem('sidebarCollapsed') === 'true') {
                const sidebar = document.getElementById('adminSidebar');
                const icon = document.getElementById('sidebarToggleIcon');
                if (sidebar && icon) {
                    sidebar.classList.add('collapsed');
                    icon.classList.remove('fa-chevron-left');
                    icon.classList.add('fa-chevron-right');
                }
            }
        });

        // Toggle User Menu (global)
        window.toggleUserMenu = function () {
            const userMenu = document.getElementById('userMenu');
            if (userMenu) {
                userMenu.classList.toggle('active');
            }
        };

        // Fechar user menu ao clicar fora
        document.addEventListener('click', (e) => {
            const userMenu = document.getElementById('userMenu');
            if (userMenu && !userMenu.contains(e.target)) {
                userMenu.classList.remove('active');
            }
        });

        // Fun√ß√£o para regenerar chave
        async function regenerateKey(email) {
            if (!confirm('Tem certeza que deseja regenerar a chave de licen√ßa? A chave antiga ser√° invalidada.')) {
                return;
            }

            try {
                const response = await fetch('/admin/manage-subscription', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: email,
                        action: 'regenerate-key'
                    })
                });

                const data = await response.json();
                if (data.success) {
                    alert('Chave regenerada com sucesso!');
                    location.reload();
                } else {
                    alert('Erro: ' + data.message);
                }
            } catch (error) {
                alert('Erro ao regenerar chave: ' + error.message);
            }
        }

        // Fun√ß√£o para copiar chave
        function copyKey(key) {
            navigator.clipboard.writeText(key).then(() => {
                const btn = event.target.closest('button');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i class="fa-solid fa-check text-success"></i>';
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                }, 2000);
            });
        }

        // Marcar notifica√ß√£o como lida
        async function markAsRead(notificationId) {
            try {
                const response = await fetch('/admin/notification/${notificationId}/read', {
                    method: 'POST'
                });
                const data = await response.json();
                if (data.success) {
                    location.reload();
                }
            } catch (error) {
                console.error('Erro ao marcar notifica√ß√£o como lida:', error);
            }
        }

        // Fun√ß√£o para expandir/colapsar detalhes da linha (escopo global)
        window.toggleRowDetails = function toggleRowDetails(index) {
            const detailsRow = document.getElementById('details-' + index);
            const mainRow = document.querySelector('[data-license-id="license-' + index + '"]');
            
            if (!detailsRow || !mainRow) {
                console.error('‚ùå Erro: Elementos n√£o encontrados para index:', index);
                return;
            }
            
            const expandBtn = mainRow.querySelector('.btn-expand-row');

            if (detailsRow.style.display === 'none' || !detailsRow.style.display) {
                detailsRow.style.display = 'table-row';
                mainRow.classList.add('expanded');
                if (expandBtn) {
                    expandBtn.classList.add('expanded');
                }
            } else {
                detailsRow.style.display = 'none';
                mainRow.classList.remove('expanded');
                if (expandBtn) {
                    expandBtn.classList.remove('expanded');
                }
            }
        };

        // TESTE: Fun√ß√£o simplificada para placeholders - removendo estilos inline que podem interferir
        // COMENTADO TEMPORARIAMENTE PARA TESTAR SE OS ESTILOS CSS EST√ÅTICOS S√ÉO SUFICIENTES
        /*
        function forcePlaceholderStyles() {
            // REMOVIDO: Aplica√ß√£o de estilos inline que podem interferir com placeholders
            // REMOVIDO: Cria√ß√£o din√¢mica de m√∫ltiplos elementos <style>
            // REMOVIDO: M√∫ltiplas execu√ß√µes com setTimeouts
            
            console.log('‚ö†Ô∏è Fun√ß√£o forcePlaceholderStyles DESABILITADA para teste');
        }
        
        // DESABILITADO: Execu√ß√£o autom√°tica
        // if (document.readyState === 'loading') {
        //     document.addEventListener('DOMContentLoaded', forcePlaceholderStyles);
        // } else {
        //     forcePlaceholderStyles();
        // }
        // setTimeout(forcePlaceholderStyles, 50);
        // setTimeout(forcePlaceholderStyles, 200);
        // setTimeout(forcePlaceholderStyles, 500);
        // setTimeout(forcePlaceholderStyles, 1000);
        // setTimeout(forcePlaceholderStyles, 2000);
        
        // DESABILITADO: MutationObserver que executava a fun√ß√£o m√∫ltiplas vezes
        // const observer = new MutationObserver(function(mutations) {
        //     mutations.forEach(function(mutation) {
        //         if (mutation.addedNodes.length) {
        //             forcePlaceholderStyles();
        //         }
        //     });
        // });
        // observer.observe(document.body, { childList: true, subtree: true });
        
        // DESABILITADO: Event listener de foco
        // document.addEventListener('focusin', function(e) {
        //     if (e.target && e.target.classList && e.target.classList.contains('form-control')) {
        //         setTimeout(forcePlaceholderStyles, 10);
        //     }
        // });
        */

        console.log('‚úÖ JavaScript de placeholders DESABILITADO - usando apenas CSS est√°tico para teste');

        // Event delegation para bot√µes de expandir (funciona mesmo com CSP)
        // Remover listener anterior se existir
        if (window._expandButtonHandler) {
            document.removeEventListener('click', window._expandButtonHandler, true);
        }
        
        window._expandButtonHandler = function(e) {
            const expandBtn = e.target.closest('.btn-expand-row');
            
            if (expandBtn) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                
                // Encontrar a linha principal
                const mainRow = expandBtn.closest('.table-row-main');
                if (!mainRow) {
                    console.warn('‚ö†Ô∏è mainRow n√£o encontrado');
                    return;
                }
                
                const licenseId = mainRow.getAttribute('data-license-id');
                if (!licenseId) {
                    console.warn('‚ö†Ô∏è licenseId n√£o encontrado');
                    return;
                }
                
                const index = licenseId.replace('license-', '');
                console.log('üñ±Ô∏è Bot√£o expandir clicado para index:', index);
                
                if (typeof window.toggleRowDetails === 'function') {
                    window.toggleRowDetails(index);
                } else {
                    console.error('‚ùå toggleRowDetails n√£o est√° dispon√≠vel, tipo:', typeof window.toggleRowDetails);
                }
                
                return false;
            }
        };
        
        // Adicionar listener no document (capture phase)
        document.addEventListener('click', window._expandButtonHandler, true);
        
        function setupExpandButtons() {
            console.log('üîç Configurando event listeners para bot√µes de expandir...');
            
            // Tamb√©m configurar clique na linha inteira (exceto bot√µes)
            const mainRows = document.querySelectorAll('.table-row-main');
            mainRows.forEach(row => {
                // Remover listener anterior se existir
                const newRow = row.cloneNode(true);
                row.parentNode.replaceChild(newRow, row);
                
                newRow.addEventListener('click', function (e) {
                    // N√£o expandir se clicar em bot√µes, links ou selects
                    if (e.target.closest('button, a, select, form, .btn-expand-row')) {
                        return;
                    }
                    const licenseId = newRow.getAttribute('data-license-id');
                    if (!licenseId) return;
                    const index = licenseId.replace('license-', '');
                    if (typeof window.toggleRowDetails === 'function') {
                        window.toggleRowDetails(index);
                    }
                });
            });
            
            console.log('‚úÖ Event listeners configurados para', mainRows.length, 'linhas');
        }
        
        // Configurar quando DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setupExpandButtons);
        } else {
            setupExpandButtons();
        }
        
        // Tamb√©m configurar ap√≥s window.load
        window.addEventListener('load', function() {
            setTimeout(setupExpandButtons, 100);
        });

        // Fun√ß√£o para adicionar event listener aos bot√µes (Novo Cliente e Criar Teste)
        function setupButtonListener() {
            // Bot√£o Novo Cliente
            const btnNovoCliente = document.getElementById('btnNovoCliente');
            if (btnNovoCliente) {
                // Adicionar listener adicional como backup
                btnNovoCliente.addEventListener('click', function (e) {
                    // Se o data-bs-toggle n√£o funcionar, usar nossa fun√ß√£o
                    setTimeout(function () {
                        const modal = document.getElementById('newClientModal');
                        if (modal && !modal.classList.contains('show')) {
                            console.log('üîÑ data-bs-toggle n√£o funcionou, usando fun√ß√£o manual...');
                            if (typeof window.openNewClientModal === 'function') {
                                window.openNewClientModal();
                            }
                        }
                    }, 100);
                });
                console.log('‚úÖ Event listener de backup adicionado ao bot√£o Novo Cliente');
            } else {
                console.warn('‚ö†Ô∏è Bot√£o btnNovoCliente n√£o encontrado');
            }
            
            // Bot√£o Criar Teste
            const btnCriarTeste = document.getElementById('btnCriarTeste');
            if (btnCriarTeste) {
                btnCriarTeste.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('üñ±Ô∏è Bot√£o Criar Teste clicado');
                    if (typeof window.openNewClientModal === 'function') {
                        window.openNewClientModal();
                    } else {
                        console.error('‚ùå openNewClientModal n√£o est√° dispon√≠vel');
                        alert('Erro: Fun√ß√£o n√£o dispon√≠vel. Recarregue a p√°gina.');
                    }
                    return false;
                });
                console.log('‚úÖ Event listener adicionado ao bot√£o Criar Teste');
            } else {
                console.warn('‚ö†Ô∏è Bot√£o btnCriarTeste n√£o encontrado');
            }
        }

        // Fun√ß√£o para adicionar listener ao bot√£o de diagn√≥stico (usando event delegation)
        function setupDiagnosticButton() {
            // Usar event delegation no modal para garantir que funcione sempre
            const modal = document.getElementById('newClientModal');
            if (!modal) {
                console.warn('‚ö†Ô∏è Modal n√£o encontrado para anexar listener de diagn√≥stico');
                return;
            }

            // Remover listener anterior se existir (usando uma flag)
            if (modal._diagnosticListenerAttached) {
                console.log('‚ÑπÔ∏è Listener de diagn√≥stico j√° anexado');
                return;
            }

            // Usar event delegation no modal - funciona mesmo se o bot√£o for criado depois
            modal.addEventListener('click', function (e) {
                // Verificar se o clique foi no bot√£o de diagn√≥stico
                if (e.target && (e.target.id === 'btnDiagnostic' || e.target.closest('#btnDiagnostic'))) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('üîç Bot√£o de diagn√≥stico clicado via event delegation!');
                    if (typeof window.runCreateClientDiagnostic === 'function') {
                        window.runCreateClientDiagnostic();
                    } else {
                        console.error('‚ùå Fun√ß√£o runCreateClientDiagnostic n√£o est√° definida!');
                        alert('Erro: Fun√ß√£o de diagn√≥stico n√£o est√° dispon√≠vel. Recarregue a p√°gina.');
                    }
                }
            });

            modal._diagnosticListenerAttached = true;
            console.log('‚úÖ Event delegation de diagn√≥stico anexado ao modal');
        }

        // Atualiza a √°rea de resultado do diagn√≥stico dentro do modal
        function updateDiagnosticResult(title, message, details = '', type = 'info') {
            console.log('üìù updateDiagnosticResult chamado:', { title, message, details, type });
            const resultDiv = document.getElementById('diagnosticResult');
            const iconEl = document.getElementById('diagnosticIcon');
            const titleEl = document.getElementById('diagnosticTitle');
            const messageEl = document.getElementById('diagnosticMessage');
            const detailsEl = document.getElementById('diagnosticDetails');

            if (!resultDiv) {
                console.error('‚ùå Elemento diagnosticResult n√£o encontrado!');
                return;
            }
            console.log('‚úÖ Elemento diagnosticResult encontrado, exibindo...');

            // Mostrar √°rea de resultado
            resultDiv.style.display = 'block';

            // Configurar cores e √≠cones baseado no tipo
            const config = {
                info: {
                    icon: 'fa-spinner fa-spin',
                    color: '#3b82f6',
                    bgColor: 'rgba(59, 130, 246, 0.1)',
                    borderColor: 'rgba(59, 130, 246, 0.4)'
                },
                success: {
                    icon: 'fa-check-circle',
                    color: '#10b981',
                    bgColor: 'rgba(16, 185, 129, 0.1)',
                    borderColor: 'rgba(16, 185, 129, 0.4)'
                },
                error: {
                    icon: 'fa-times-circle',
                    color: '#ef4444',
                    bgColor: 'rgba(239, 68, 68, 0.1)',
                    borderColor: 'rgba(239, 68, 68, 0.4)'
                }
            };

            const cfg = config[type] || config.info;

            // Atualizar √≠cone e t√≠tulo
            if (iconEl) {
                iconEl.className = 'fa-solid ${cfg.icon} me-2';
                iconEl.style.color = cfg.color;
            }
            if (titleEl) {
                titleEl.textContent = title;
                titleEl.style.color = cfg.color;
            }

            // Atualizar mensagem
            if (messageEl) {
                messageEl.innerHTML = message;
                messageEl.style.color = 'var(--text-primary)';
            }

            // Atualizar detalhes
            if (detailsEl) {
                if (details) {
                    detailsEl.innerHTML = '<strong>Detalhes:</strong> ${details}';
                    detailsEl.style.display = 'block';
                } else {
                    detailsEl.style.display = 'none';
                }
            }

            // Atualizar estilo do card
            const card = resultDiv.querySelector('.card');
            if (card) {
                card.style.borderColor = cfg.borderColor;
                card.style.background = cfg.bgColor;
            }

            // Scroll para o resultado
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Atualiza a √°rea de status do diagn√≥stico (texto objetivo no rodap√© do modal)
        function updateDiagnosticStatus(status, detail = '', type = 'info') {
            const el = document.getElementById('diagnosticStatus');
            if (!el) return;
            const colors = {
                info: 'var(--text-secondary)',
                success: '#10b981',
                error: '#ef4444'
            };
            el.style.color = colors[type] || colors.info;

            const icons = {
                info: '‚è≥',
                success: '‚úÖ',
                error: '‚ùå'
            };
            const icon = icons[type] || icons.info;
            el.innerHTML = '<strong>${icon} ${status}</strong>${detail ? ' ‚Äî ' + detail : ''}';
        }

        // Fun√ß√£o para adicionar listener ao formul√°rio (SEM onsubmit inline - CSP bloqueava)
        function setupFormListener() {
            const form = document.getElementById('newClientForm');
            if (form) {
                console.log('‚úÖ Formul√°rio encontrado, anexando listener...');
                form.addEventListener('submit', function (e) {
                    e.preventDefault();
                    console.log('üìù Formul√°rio submetido!');
                    submitNewClient(e);
                });
                console.log('‚úÖ Listener do formul√°rio anexado com sucesso!');
            } else {
                console.warn('‚ö†Ô∏è Formul√°rio newClientForm n√£o encontrado');
            }
        }

        // Inicializar fun√ß√µes do modal quando a p√°gina carregar
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function () {
                console.log('‚úÖ DOM carregado, iniciando fun√ß√µes do modal');
                initModalFunctions();
                setupButtonListener();
                setupDiagnosticButton();
                setupFormListener(); // Anexar listener do formul√°rio
            });
        } else {
            // DOM j√° carregado
            console.log('‚úÖ DOM j√° carregado, iniciando fun√ß√µes do modal imediatamente');
            initModalFunctions();
            setupButtonListener();
            setupDiagnosticButton();
            setupFormListener(); // Anexar listener do formul√°rio
        }

        // Tentar inicializar tamb√©m quando a janela carregar completamente
        window.addEventListener('load', function () {
            console.log('‚úÖ Window carregada completamente');
            if (typeof window.openNewClientModal !== 'function') {
                console.warn('‚ö†Ô∏è Fun√ß√£o ainda n√£o definida ap√≥s window.load, tentando novamente...');
                initModalFunctions();
            }
            setupButtonListener();
            setupDiagnosticButton();
            setupFormListener(); // Anexar listener do formul√°rio

            // Adicionar listener para quando o modal Bootstrap for mostrado
            const modalElement = document.getElementById('newClientModal');
            if (modalElement && typeof bootstrap !== 'undefined') {
                modalElement.addEventListener('shown.bs.modal', function () {
                    console.log('üì¶ Modal Bootstrap foi mostrado, re-anexando listeners...');
                    setTimeout(() => {
                        setupDiagnosticButton();
                        setupFormListener();
                    }, 100);
                });
            }
        });

    </script>

    </div>
    </div>
    </div>
</body>

</html>